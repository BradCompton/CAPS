    ∇ Z←H MATIN F;X;REST;S;T;C;Q;B[1]   ⍝Read mixed matrix from file ⍵.[2]   ⍝  ⍺[1] 0: No header, 1: file has header, 2: figure it out [default][3]   ⍝  ⍺[2] Optional delimiter, otherwise commas, tabs, or spaces are used; tab is always a delimiter[4]   ⍝  ⍺[3] 1: Force all-text, ¯1: and assume missing is text[5]   ⍝  ⍺[4] 1: Don't strip comments if ⍺[4] - use this for huge files with no comments or if you want to keep semicolons in place[6]   ⍝  ⍺[5] 1: Round all numeric columns to integer[7]   ⍝Columns may be numeric or text (no internal spaces or commas allowed; don't use quotes)[8]   ⍝Anything after a semicolon is a comment (added 30 Dec 2003)[9]   ⍝Allow lower-case 'e' in exponential for compatibility with R (4 Mar 2006)[10]  ⍝If numeric cells are empty, fill in with MV (9 Mar 2006)[11]  ⍝No quotes (5 May 2006)[12]  ⍝21 Jan 09: tab is always a delimiter; ⍺[3][13]  ⍝31 Mar 2011: Oops...delimiter & missing header troubles.[14]  ⍝14 Apr 2011: also drop double quotes (removed 11 May 2011)[15]  ⍝19 Apr 2011: allow ⍺[3]=¯1 to assume text for missing; 22 Apr 2011: make it work right[16]  ⍝20 Jan 2014: add rounding option and convert to if-else structure[17]  ⍝10 Mar 2014: missed a place for lowercase exponents, and allow 1E+1 (from R) - now use FIXEXP[18]  ⍝24 Nov 2015: when dropping trailing newlines, also drop trailing white space (eliminate spurious tabs on last line)[19]  [20]  [21]  [22]   ⍎(0=⎕NC'H')/'H←2'[23]   C←1↑1↓(H←,H),' '                                                   ⍝Delimiter[24]   X←NREAD F[25]   :if ~(4↑H)[4]                                                      ⍝If stripping comments,[26]      X←1↓MTOV (∨/X≠' ')⌿X←LJUST(⍴X)↑(+/^\';'≠X)⌽((⍴X)⍴' '),X←VTOM ⎕TCNL,X  ⍝   Semicolons mark comments[27]   :end[28]   X←(-+/^\⌽X∊⎕TCNL,⎕TCHT,' ')↓X                                      ⍝Drop trailing newlines and white space[29]   :if ~2≤⍴H                                                          ⍝If delimiter not supplied,[30]      X←('/,/ /',⎕TCHT,'/ ') TEXTREPL X                               ⍝   use tab, comma, or space[31]   :end[32]   X←('/',⎕TCHT,'/',C) TEXTREPL X                                     ⍝In any case, tab is always a delimiter[33]  ⍝⍝ ⎕ERROR ((C≠' ')^∨/T[1]≠T←+/C=VTOM ⎕TCNL,X)/'Error: ragged delimiters when reading ',F  THIS DOESN'T WORK BECAUSE OF TABS BEFORE COMMENTS[34]   head←(H[1]>0)/(¯1+S←X⍳⎕TCNL)↑X[35]   X←(T←((H[1]=1)∨(H[1]=2)^(~0∊⍴X)^0∊⎕VI,' ',C MATRIFY FIXEXP head)×S)↓X     ⍝1st line is header...if any non-numeric[36]   head←(T≠0)/head[37]   X←VTOM C FIRSTCOL X[38]   X←((0,Q←⍴⍕MV)⌈⍴X)↑X[39]   X[T;⍳Q]←((⍴T←(^/X=' ')/⍳1↑⍴X),Q)⍴(Q←⍴⍕MV)↑(0≥(3↑H)[3])/⍕MV         ⍝Fill in missing values[40]   Z←(⎕FI FIXEXP T←' ',X)∘.+,0[41]   :if ~(1≠(3↑H)[3])^^/⎕VI FIXEXP T                                   ⍝If character,[42]      Z←((⍴T)[1],1)⍴FRDBL¨↓LJUST T[43]   :elseif (5↑H)[5]                                                   ⍝else if rounding numberic,[44]      Z←⌊.5+Z[45]   :end[46]  [47]  L1:→((^/REST=⎕TCNL)^0∊⍴X←VTOM C FIRSTCOL REST)/L9[48]   :if ~(~0∊⍴X)^(1≠(3↑H)[3])^^/⎕VI FIXEXP ,' ',X                      ⍝If non-numeric,[49]      Z←Z,FRDBL¨↓LJUST X[50]   :else                                                              ⍝else, numeric[51]      X←((0,Q←⍴⍕MV)⌈⍴X)↑X[52]      X[T;⍳Q]←((⍴T←(^/X=' ')/⍳1↑⍴X),Q)⍴Q↑(0≥(3↑H)[3])/⍕MV             ⍝   Fill in missing values[53]      Z←Z,⎕FI FIXEXP ,' ',X[54]      :if (5↑H)[5]                                                    ⍝else if rounding numberic,[55]         Z[;1↓⍴Z]←⌊.5+Z[;1↓⍴Z][56]      :end[57]   :end[58]   →L1[59]  [60]  L9:→((3↑H)[3]≠¯1)/0     ⍝If all missing values are character,[61]   :if Z≡1 1⍴MV           ⍝   If file is empty,[62]      Z←0 0⍴''[63]   :else[64]     B←MV≡¨T←,Z           ⍝Else, missing to blanks[65]      T[B/⍳⍴B]←⊂''[66]      Z←(⍴Z)⍴T[67]   :end    ∇