    ∇ K QSHED2a I;J;Q;L;T;D[1]   ⍝Subroutine of QSHED; recurse up the watershed from cell ⍵ and influence ⍺[2]   ⍝Build influence grid on the way up, and other grids on the way down[3]   ⍝Globals:[4]   ⍝   X   landcover grid[5]   ⍝   F   flow grid[6]   ⍝   R   resistance grid[7]   ⍝   M   metric grids[8]   ⍝   Z   result grids (pointers: inf, suminf, mininf, wsize, metrics)[9]   ⍝B. Compton, 17 Sep 2009[10]  [11]   I J←I[12]  [13]   Z[inf;I;J]←K                         ⍝Influence value given resistance[14]  [15]   Q←F FLOWINTOO C                             ⍝Source cells[16]   T←1⌈(2*.5)×~+/Q=(⍴Q)⍴C                       ⍝Distance correction for diagonal flow[17]   K←K-T×.5×R[I;J]+R SCATI Q[18]  [19]   K QSHED2¨↓Q                                ⍝Recurse up watershed[20]  [21]  ⍝Now accumulate results on the way back down[22]   Z[wsize;I;J]←1++/Z[wsize;;] SCATI Q                  ⍝Watershed size[23]   Z[suminf;I;J]←Z[inf;I;J]++/Z[suminf;;] SCATI Q ⍝Sum of influence[24]   Z[mininf;I;J]←(Z[inf;I;J]-.5×R[I;J])⌊⌊/Z[mininf;;] SCATI Q ⍝Minimum influence: min of contributers & this cell - 1/2 of resistance[25]  [26]   L←0[27]   Z[inf;I;J],Z[inf;;] SCATI Q                            ⍝Influence of this cell and sources[28]  L1:→((1↑⍴M)<L←L+1)/0                                            ⍝For each metric,[29]   Z[mstart+2×L;I;J]←(M[L;I;J])++/Z[mstart+2×L;;] SCATI Q    ⍝   Raw metric[30]   Z[mstart+1+2×L;I;J]←(Z[inf;I;J]×M[L;I;J])++/Z[mstart+1+2×L;;] SCATI Q                          ⍝   Influenced metric[31]   →L1    ∇