    ∇ P INIT_S O;F;S[1]   ⍝Set up paths and grid for something running in CAPS environment with grid server; given optional override_pars ⍵; don't set paths if ⍺[2]   ⍝B. Compton, 28 May 2009[3]   ⍝24-26 May 2011: work with Anthill[4]   ⍝31 Aug 2011: Fix bugs to localize parameter files properly[5]   ⍝23 Jan 2012: Integrate override_pars[6]   ⍝7 May 2013: reset pathdir in case a previous task from another run had it set--I was getting leaky runs![7]   ⍝4 Nov 2013: rewrite grid server initialization for new grid server[8]   [9]   [10]  ⍝OBSOLETE![11]  [12]   ⍎(0=⎕NC'P')/'P←0'[13]   pathdir←'paths.par'            ⍝Reset paths.par in case a previous task changed it[14]   →(0∊⍴O)/L0                     ⍝If override_pars is passed,[15]   override_pars←NREAD O          ⍝   read and set it[16]   SETPARS override_pars          ⍝   set override_pars in case it sets pathdir[17]  L0:[18]   :if ~P[19]      SETPATHS                    ⍝   now set paths, unless we're not to[20]   :end[21]   warn←1                         ⍝Set hard-wired parameters[22]   warnings←0 0⍴''[23]   fn←'caps'[24]   noread←fileptr←test←loop←block←0[25]   firstblock←ifchat←1[26]  [27]   pars←''[28]   1 READPARS fn←'caps'           ⍝Read options from override_pars, if present (e.g., set pathI here)[29]  [30]   pathI CHECKFILE 'parameters.par'[31]   →(0∊⍴warnings)/L1[32]   ⎕←warnings[33]   →0[34]  L1:pars←NREAD pathI PATH 'parameters.par'[35]   READPARS fn←'caps'             ⍝Read CAPS options[36]   SETBREAK[37]   landcover←¯1 TABLE landcoverpar[38]   metrics←GETMETRICS[39]   warnings←0 0⍴''[40]   logfile←pathP PATH 'caps.log'[41]   mask←(IFEXISTS mask,'\')/mask←1 GRIDNAME 'mask'                ⍝Mask grid, if it exists[42]  [43]  ⍝Initialize grid server(s)[44]   ⎕←'Connecting to grid server(s)...' ⋄ FLUSH[45]   CLEANUP[46]   F←0                                            ⍝Flag: got a grid server[47]   refgrid←(1+0∊⍴GRIDNAME 'reference')⊃1 GRIDNAME 'reference' 'mosaicref'   ⍝If refgrid isn't set, use mosaicref[48]   referencewindow←⍳0                             ⍝Make sure we'll set this[49]   :if landscapewide^~0∊⍴gridserver               ⍝If landscapewide, and using defined grid server and port,[50]      1 GRIDINIT gridserver                       ⍝   use it[51]      1 SETWINDOW refgrid                         ⍝   and set window[52]      F←1[53]   :end[54]  [55]   :if mosaics[56]      MOSAICINIT (1 GRIDNAME 'mosaicref') 'gridservers.txt'[57]      F←1[58]   :elseif ~F[59]      GRIDINIT ''                                 ⍝      open a local gridserver[60]   :end[61]  [62]  [63]   :if landscapewide^0∊⍴gridserver                ⍝If landscapewide, and not using defined grid server and port,[64]      referencewindow←GRIDDESCRIBE refgrid        ⍝   get the window for the reference grid (or mosaic)[65]      S←FINDSERVER referencewindow refgrid    ⍝   find a grid server that matches this window[66]      ⎕ERROR (0∊⍴S)/'No grid server in ',pathA,'gridservers.txt for reference grid ',refgrid,', window = (',(1↓⊃,/',',¨⍕¨5↑referencewindow),')'[67]      1 GRIDINIT S[68]      1 SETWINDOW refgrid[69]      ⍝SETCONNECTION C[70]      ⍝SETCACHE caching[71]      ⍝ACTIVATECONNECTION[72]   :end[73]  [74]   ⎕←'Grid servers initialized.' ⋄ FLUSH    ∇