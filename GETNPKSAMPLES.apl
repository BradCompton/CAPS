    ∇ GETNPKSAMPLES;X;X_;head;N;N_;P;P_;Y;Y_;T[1]   ⍝Assemble sample data for Betsy's NPK metrics[2]   ⍝Data come from four different source files; results to d:\caps\project\npksamples.txt[3]   ⍝End up with 343 sites, which is fewer than Betsy claims in document...not sure why.[4]   ⍝B. Compton, 28 May 2015[5]   [6]   [7]   [8]    X←MATIN 'g:\CAPSdocs\Betsy\NPK\CAPSNutrient-v20\InputData\NpkData-weighted-v51.txt'    ⍝X variables[9]    X_←MATRIFY '.".' TEXTREPL head[10]   X[;X_ COL 'site']←(⊂'.".') TEXTREPL¨X[;X_ COL 'site'] [11]   [12]   N←MATIN 'g:\CAPSdocs\Betsy\NPK\CAPSNutrient-v20\InputData\NitrogenSamplesAvg.txt'      ⍝Nitrogen[13]   N_←MATRIFY '.".' TEXTREPL head[14]   N[;N_ COL 'site']←(⊂'.".') TEXTREPL¨N[;N_ COL 'site'] [15]  [16]   P←MATIN 'g:\CAPSdocs\Betsy\NPK\CAPSNutrient-v20\InputData\PhosSamplesAvg.txt'          ⍝Phosphorus[17]   P_←MATRIFY '.".' TEXTREPL head[18]   P[;P_ COL 'site']←(⊂'.".') TEXTREPL¨P[;P_ COL 'site'] [19]   [20]   Y←1 ⎕TCHT MATIN 'd:\CAPS\more\NPK\source\pass1_npksamples.txt'                         ⍝Locations[21]   Y_←⎕TCHT MATRIFY head[22]   Y←(~Y[;Y_ COL 'excluded'])⌿Y                                                           ⍝Drop excluded sites[23]   [24]   X←X,(N⍪¯9999)[N[;N_ COL 'site']⍳X[;X_ COL 'site'];N_ COL 'avgtn'][25]   X_←X_ OVER 'Nitrogen'[26]  [27]   X←X,(P⍪¯9999)[P[;P_ COL 'site']⍳X[;X_ COL 'site'];P_ COL 'avgtP'][28]   X_←X_ OVER 'Phosphorus'[29]  [30]   X←X,(Y⍪¯9999)[Y[;Y_ COL 'site']⍳X[;X_ COL 'site'];Y_ COL 'xprojected yprojected'][31]   X_←X_ OVER MATRIFY 'x-coord y-coord'[32]  [33]   X←(^/X[;X_ COL 'nitrogen phosphorus x-coord y-coord']≠¯9999)⌿X                         ⍝Drop unmatched rows in N, P, and X,Y[34]  [35]  ⍝Reorder and use my names[36]   X←X[;X_ COL 'site x-coord y-coord nitrogen phosphorus area mintemp meanprecip imperv discharge septic cropland cranberry_bog forest forested_wetland deep_marsh urban_open total_lowland'][37]   X_←MATRIFY 'site x-coord y-coord nitrogen phosphorus area tmin precip impervini dischargeni septic cropland cranberry forest fowet deepmarsh urbanopen lowland'[38]   [39]   head←1↓⎕TCHT MTOV X_[40]   X TMATOUT T←'d:\caps\project\npksamples.txt'[41]   ⎕←'NPK samples written to d:\caps\project\npksamples.txt'    ∇