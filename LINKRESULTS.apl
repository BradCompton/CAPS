    ∇ K LINKRESULTS H;S;A;D;U;B;Q;R;Y;head;I;A;J;M;E;Z;G;T;pathR;pathT[1]   ⍝Find best single units for bandwidths ⍵[2]   ⍝AND DO SOMETHING WITH MANYLINKS, SOMEHOW.... within ⍺ km of each node's centroid for CL II.  If ⍵=0, just do singlelinks.[3]   ⍝By default, best results are landscape-wide (⍵=1E6)[4]   ⍝B. Compton, 16-22 Jan and 4-11 Feb 2013[5]   ⍝20 Apr 2013: combine multiple bandwidths into one result file[6]   [7]   [8]   [9]    ⍎(0=⎕NC'K')/'K←1E6'[10]   SETPATHS[11]   U←0 1 TABLE pathQ,'tables\liveunits.txt'           ⍝List of units[12]   Z←U,((1↑⍴U),⍴H←,H×1000)⍴0[13]   I←0[14]  L5:→((⍴H)<I←I+1)/L6                                 ⍝For each bandwidth,[15]   S←MATIN pathQ,'tables\singlelinks',(⊃KNAMES H[I]),'.txt'[16]   Z[Z[;1]⍳S[;2];I+3]←S[;1]                           ⍝   get singlelinks results for all live units[17]   →L5[18]  [19]  L6:Z[;3↓⍳1↓⍴Z]←2 ROUND 0 3↓Z[20]   Z←(∨/0≠0 3↓Z)⌿Z[21]   Z←Z[⍒⌽0 3↓Z;]                                      ⍝Sort by largest bandwidth first[22]   head←1↓⎕TCHT MTOV MATRIFY 'unit x-coord y-coord',⊃,/(⊂' delta'),¨KNAMES H[23]   Z TMATOUT FRDBL ⎕←'   ',pathQ,'results\linkages.txt'[24]  [25]  [26]  [27]  [28]   →0[29]  [30]   →(0≡N)/0                               ⍝If ⍵=0, don't do many links--just exit[31]  [32]  [33]   A←MATIN pathQ,'tables\manylinks.txt'[34]   M←0 1 TABLE pathQ,'tables\nodes.txt'[35]   M[;4]←(M[;4]≠¨'''') SLASHEACH M[;4][36]   D←0 1 TABLE pathQ,'tables\unitindex.txt'[37]  [38]  [39]  ⍝ S←0 ¯1↓S ⋄ A←A[⍳10;]     ⍝FOR TESTING[40]  [41]  ⍝S is delta, unit for each single test[42]  ⍝A is number of units, joint delta, sum of individual deltas, synergism ratio, and list of units for each joint test[43]  [44]   A←A⍪((1↑⍴S),1↓⍴A)↑S                    ⍝Add single tests to list of multiple tests[45]   A←0,A[;1],0,0,0 1↓A←0 MVREP A[46]   A[;1]←+/0≠0 4↓A                        ⍝Number of units in each group[47]   A[;3]←+/(S[;1],0)[(⊂S[;2])⍳¨0 4↓A]     ⍝Sum of individual deltas[48]  [49]  STOP     ⍝NOT SURE WHAT IS GOING ON HERE[50]  [51]   A[;4]←-/A[;2 3]                           ⍝Synergy gain[52]  [53]   ⍝WHY DO SOME OF THEM (E.G., SELECTED TRIPLE IN ARCVIEW) HAVE MORE GAIN FROM SUM OF SINGLES THAN FROM MANY?[54]  [55]  ⍝ A←(A[;4]≥1)⌿A                          ⍝Throw out joints with synratio < 1 -- these are spurious; better to take the good singles[56]   A←A[⍒A[;4];]                           ⍝Sort by synergy gain[57]  [58]   A←(⍳1↑⍴A),A[59]  ⍝ A←A[⍳10;]      ⍝TAKE TOP 10 S.G. FOR NOW[60]   Z←(Z[;6]≠0)⌿Z←((¯5+1↓⍴A)⌿A[;⍳5]),,0 5↓A         ⍝ONE ROW PER UNIT[61]   Z←Z,U[U[;1]⍳Z[;6];2 3]      ⍝GET UNIT X,Y[62]   Z←Z[;⍳2],((S⍪0)[S[;2]⍳Z[;6];1]),0 2↓Z          ⍝Add singleunits ∆PC to each row[63]  [64]   head←1↓⎕TCHT MTOV MATRIFY 'group nunits single joint sum gain unit x-coord y-coord'[65]   Z TMATOUT FRDBL ⎕←'   ',pathQ,'results\NEWmanyunits',(⊃KNAMES N),'.txt'[66]  [67]  [68]   ASDF[69]  [70]  [71]  [72]  [73]   Z←0 7⍴0[74]   N←,N[75]   I←0[76]  L1:→((⍴N)<I←I+1)/L2                     ⍝For each n,[77]   J←0[78]  L3:→(((K=1E6)^J>1)∨(1↑⍴M)<J←J+1)/L4      ⍝   For each node (or only once, if ⍺=1E6),[79]  ⍝ E←(∨/D[;2 3]=M[J;1])/D[;1]             ⍝      Units with at least one path to/from this node[80]   E←(((+/(U[;2 3]-((1↑⍴U),2)⍴M[J;2 3])*2)*.5)≤K×1000)/U[;1]   ⍝      Units within ⍺ km of node centroid[81]   G←(∨/(0 4↓A)∊E)⌿A[82]   R←(G[;1 2],(+/¨T≠¨0)↑¨T←↓0 4↓G) BEST N[I] ⍝      Pick best n units involving this node[83]   ⎕←'Node ',(⊃M[J;4]),' (',(⍕M[J;1]),'): best ',(⍕N[I]),' units: delta = ',⍕R[1][84]  [85]  ⍝Result text file for chosen units is unit #, x, y, # of units in selected joint, selected joint delta, individual delta, synergism ratio[86]   Q←(Q≠0)/Q←,0 4↓G[1↓R;]                 ⍝   The optimal units[87]   Y←Q,U[U[;1]⍳Q;2 3],Y[;1]⌿Y←G[1↓R;1 2 2 4][88]   Y[;6]←S[S[;2]⍳Q;1][89]   Z←Z⍪Y[90]   →L3[91]  [92]  L4:head←1↓⎕TCHT MTOV MATRIFY 'unit x-coord y-coord units jointdelta singledelta synratio'[93]   Z←Z[⍋Z[;1];][94]   Z←(Z[;1]≠0,¯1↓Z[;1])⌿Z                 ⍝Remove duplicate units[95]   Z TMATOUT FRDBL ⎕←'   ',pathQ,'results\best',(FRDBL⍕N[I]),'-',((1+K=1E6)⊃((⍕K),'km') 'all'),'.txt'[96]   FLUSH[97]   →L1[98]  [99]  L2:⎕←'Done.'    ∇