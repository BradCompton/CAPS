    ∇ LISTGRIDS;pars;Q;M;I;T;S;X;E;V;W;Y;Z;where;threshold;D50;DS;bandwidths;norun;G;L;J;pathS;pathN;pathG;pathU;P;iei;pathW;gridwindow[1]   ⍝List all input and result grid names for CAPS metrics[2]   ⍝B. Compton, 11-12 Jan 2012[3]   [4]   [5]   [6]    P←path[7]    path←'' ⋄ pathG←'grids\' ⋄  pathS←'source\' ⋄ pathU←'rawsettings\' ⋄ pathN←'mixedsettings\' ⋄ pathW←'working\'[8]    norun←1 ⋄ threshold←.5 ⋄ where←'' ⋄ bandwidths←,1 ⋄ gridwindow←⍳5 ⋄ iei←'iei (named in parameters.par)'  ⍝Set some necessary variables[9]    pars←''[10]   W←''[11]  [12]   Q←⎕VR¨↓M←(1∊¨(⎕VR¨↓⎕NL 3) ⎕SS¨⊂'info',':')⌿⎕NL 3   ⍝Get list of metrics and ⎕VRs[13]  [14]   Z←((1↑⍴M),4)⍴0[15]   I←0[16]  L1:→((1↑⍴Q)<I←I+1)/L3           ⍝For each metric,[17]   S←(T←(∨\(I⊃Q) ⎕SS 'info',':')/I⊃Q)⍳⎕TCNL[18]   X←¯1↓5↓S↑T                     ⍝   info line[19]  [20]  L2:[21]  :Try[22]   Y←⍎X                           ⍝   execute info line[23]  :CatchIf 'VALUE ERROR'≡11↑⎕DM   ⍝   if VALUE ERROR,[24]   E←VTOM ⎕TCNL,⎕DM[25]   V←(¯1+E[3;]⍳'^')↓E[2;]         ⍝      Variable name causing error[26]   W←W,⊂V←(^\V∊'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_∆⍙')/V[27]   ⍎V,'←1'                        ⍝      set it[28]   →L2                            ⍝      and try again[29]  [30]  :EndTry[31]   Z[I;]←(⊂GETWHAT M[I;]),3↑Y[32]   →L1[33]  [34]  L3:W←⎕EX¨W[35]   Z←(FRDBL¨↓M),Z[36]   Z←Z[⎕AV⍋MIX Z[;2];][37]  [38]   X←('CAPS Metrics, data sources, and results (from LISTGRIDS, run ',NOW,')') OVER ''[39]   G←((T⍳T)=⍳⍴T)/T←Z[;2][40]   I←0[41]  L4:→((⍴G)<I←I+1)/L6             ⍝For each group of metrics,[42]   X←X OVER '' OVER '-'⍪((TOUPPER T[1]),1↓T←(I⊃G),' metrics'),[.5]'-'[43]   L←(Z[;2]≡¨G[I])/⍳1↑⍴Z[44]   J←0[45]  L5:→((⍴L)<J←J+1)/L4             ⍝   For each metric in group,[46]   X←X OVER '   ',⊃Z[L[J];][47]   X←X OVER (6⍴' ') BESIDE 'Inputs:  ' BESIDE 60 TELPRINT (¯2↑1,⍴T)⍴T←MIX⊃Z[L[J];3][48]  ⍝ X←X OVER (6⍴' '),'Source:  ',FRDBL⍕⊃Z[L[J];3][49]   X←X OVER (~0∊⍴⊃Z[L[J];4])⌿(1,⍴T)⍴T←(6⍴' '),'Settings: (grids named in ',(⍕⊃Z[L[J];4]),'.par)'[50]   X←X OVER (6⍴' '),'Results: ',FRDBL⍕⊃Z[L[J];5][51]   X←X OVER ''[52]   →L5[53]  [54]  L6:X←X OVER '' OVER ''[55]   X←X OVER 'Notes:'[56]   X←X OVER ' - Grid names given are CAPS grid aliases; they may be replaced with names supplied'[57]   X←X OVER '   in inputs.par and results.par, with optional name replacement'[58]   X←X OVER ' - Paths given are CAPS path aliasies; they may be replaced in paths.par'[59]   X←X OVER ' - Unless otherwise specified, input grids are in grids\, and result grids in results\'[60]   X←X OVER ' - Grids marked with * are optional'[61]   X←X OVER ' - Results ending in 0 are post-processed with mixwater to get raw results'[62]   X←X OVER ' - WATERSHED and WATERSHEDB are generic watershed metrics; their input grids are used'[63]   X←X OVER '   by all watershed metrics'[64]   X←X OVER ' - Some metrics require tables; tables are not listed here'[65]   X←1↓MTOV X[66]  [67]   path←P[68]   X MATOUT T←path,'listgrids.txt'[69]   ⎕←'Results written to ',T    ∇