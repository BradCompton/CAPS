    ∇ ACTIVATECONNECTION;T;A;L;W;Q[1]   ⍝Makes the pending grid server connection the active connection[2]   ⍝B. Compton, 10-30 Sep 2013[3]   ⍝8 Oct 2013: revisions to local/server stuff[4]   ⍝16 Oct 2013: major revisions. Boehner finally surrenders on the eve of the debt ceiling. Vote tonight.[5]   ⍝21 Oct 2013: no need to call ∆CLEANUP, as ∆GRIDINIT always calls it[6]   ⍝4 Nov 2013: I had window checking clauses wrong[7]   [8]   [9]   [10]   A←activeconnection[11]   :if ~MV∊A[1 2]                                                 ⍝If have active connection & cache, do checks[12]      →(^/A[1 2]=A[3 4])/0                                        ⍝   If active = pending, exit[13]      :if A[3]=MV[14]         A[3]←A[1][15]      :end[16]      :if A[4]=MV[17]         A[4]←A[2][18]      :end[19]  [20]   ⍝Special case: connection not changing, cache is, and connection is local[21]      :if (=/A[1 3])^(≠/A[2 4])^connections[A[1];connections_ COL 'local'][22]         A[2]←A[4][23]         →0[24]      :end[25]   :end[26]  [27]   L←A[4]∨connections[A[3];connections_ COL 'local']              ⍝Local mode flag[28]   W←⊃connections[A[3];connections_ COL 'window']                 ⍝Window in connections[29]   :if L                                                          ⍝If local[30]      ∆GRIDINIT ''                                                ⍝   use local grid server[31]      :if 0≠⍴W                                                    ⍝   if window isn't null,[32]         T←∆MAKEWINDOW 5↑W                                        ⍝      set it[33]      :end[34]   :else                                                          ⍝Else, a server connection,[35]      ∆GRIDINIT connections[A[3];connections_ COL 'server port log'][36]      :if ~connections[A[3];connections_ COL 'set']               ⍝   if not set,[37]         :if ~0∊⍴Q←GETWINDOW                                      ⍝      If window is set on server,[38]            :if ~0∊⍴W                                             ⍝         If window is set in connections[39]               ⎕ERROR (~(5↑Q)≡5↑W)/'Error: Window on server is different from window in connections'  ⍝            it must conform[40]            :else                                                 ⍝         Else,[41]               T←CHECKWINDOW (5↑Q) 1                              ⍝            make sure window set on server is okay[42]               ⎕ERROR (0=1↑T)/2⊃T[43]               connections[A[3];connections_ COL 'window']←⊂Q     ⍝            set window in connections[44]            :end[45]            connections[A[3];connections_ COL 'set']←1            ⍝         and set 'set'[46]         :else                                                    ⍝      else, not set on server,[47]            :if 0≠⍴W                                              ⍝         if we have a window,[48]               T←∆MAKEWINDOW 5↑W                                  ⍝            set it on the server[49]               connections[A[3];connections_ COL 'set']←1         ⍝            and set 'set'[50]            :end[51]         :end[52]      :end[53]   :end[54]  [55]   activeconnection←A[3 4],2⍴MV    ∇