    ∇ S MAKEDIR D;P;T;Q[1]   ⍝Create new directory ⍵, creating parent directory if necessary. Get lock, but suppress locking if ⍺.[2]   ⍝B. Compton, 5 May 2011[3]   ⍝21 Nov 2013: check for collisions[4]   ⍝27 Mar 2014: do several tries in IFEXISTS before throwing an error[5]   ⍝31 Mar-1 Apr 2014: that didn't work. Use Ethan's approach of locking the containing directory[6]   ⍝2 Apr 2014: a different approach[7]   ⍝3 Apr 2014: and yet a different one...this might work (it does)[8]   ⍝4 Apr 2014: a new variation...hold the lock until the directory exists[9]   [10]  [11]  [12]   ⍎(0=⎕NC'S')/'S←0'[13]   D←(-'\'=¯1↑D)↓D←FRDBL D[14]   →(IFEXISTS D,'\')/0                        ⍝If directory already exists, exit[15]   :if ~IFEXISTS P←(-¯1+(⌽D)⍳'\')↓D           ⍝If parent directory doesn't exist,[16]      MAKEDIR P                               ⍝   Create it, recursively[17]   :end[18]  [19]   :if ~S[20]      Q←LOCKFILE D,'\'                        ⍝   Lock the directory (unless suppressed)[21]   :end[22]  [23]   →(IFEXISTS D,'\')/L9                       ⍝   If it exists now, exit[24]  [25]   T←TRY '⎕MKDIR D'                           ⍝   Create directory[26]   →(60 WAITUNTILEXISTS D,'\')/L9             ⍝   Wait a whole minute for directory to be created before throwing error[27]  [28]   :if ~S[29]      UNLOCKFILE Q[30]   :end[31]  [32]  ⍝('Crash in MAKEDIR at ',((1+NOW⍳',')↓NOW),' (',(⍕?1E3),')') GETLOCK 0 ⋄ STOP                ⍝Temporary code to help with debugging ***[33]  [34]   ⎕ERROR 'MAKEDIR failed to create directory ',D,'\'[35]  [36]  L9:→S/0[37]   UNLOCKFILE Q    ∇