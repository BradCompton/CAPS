    ∇ A MAKEBIGLAKES S;head;X;buffer;L;Y;I;B;Q;big;C;Z;T;F[1]   ⍝Build biglakes table by running through in tiles (needed for big LCC landscape)[2]   ⍝Buffer must be large enough that all large lakes in core + buffer are ≥ big[3]   ⍝Parameters:[4]   ⍝   big = 400		; threshold of big lake (ha)[5]   ⍝B. Compton, 12 Feb 2014[6]   [7]   [8]   [9]    READPARS ME[10]   buffer←4⊃A[11]   X←0 MVREP READ 1⊃A                                         ⍝Read pondids with a big buffer[12]   Y←(Y≠0)/Y←,(2⍴buffer)↓(-2⍴buffer)↓X                        ⍝Wetlands in core[13]   Y←((Y⍳Y)=⍳⍴Y)/Y                                            ⍝Unique ids[14]   Q←(,X∊Y)/,X                                                ⍝All cells that fall in our target wetlands[15]   Q←Q[⍋Q][16]   B←Q≠0,¯1↓Q[17]   C←B pSUM (⍴B)⍴1                                            ⍝Number of cells in each[18]   Q←(C≥(big×1E4)÷cellsize*2)/B/Q                             ⍝Big lakes--those over threshold of big ha[19]   →(0∊⍴Q)/0                                                  ⍝Bail out if no big lakes[20]   ⎕←'Found ',(⍕⍴Q),' lake',((1≠⍴Q)/'s'),'.'[21]   Z←Q,((⍴Q),4)⍴0[22]   I←0[23]  L1:→((⍴Q)<I←I+1)/L2                                         ⍝For each big lake,[24]   Z[I;2 4]←(⌊/T),⌈/T←(∨/X=Q[I])/⍳1↑⍴X                        ⍝   xmin, xmax[25]   Z[I;3 5]←(⌊/T),⌈/T←(∨⌿X=Q[I])/⍳1↓⍴X                        ⍝   ymin, ymax[26]   →L1[27]  [28]  L2:Z[;2 5 4 3]←(↑1 FINDPOINT¨↓Z[;2 3]),↑1 FINDPOINT¨↓Z[;4 5]⍝Convert to cell coordinates[29]   Z[;2 3 4 5]←Z[;2 3 4 5]+((1↑⍴Z),4)⍴¯1 ¯1 1 1×cellsize÷2    ⍝Move points to outside cell corners[30]   L←LOCKFILE F←pathT PATH 'biglakes.txt'                     ⍝Lock result file[31]   X←MATIN F                                                  ⍝Read previous results[32]   →(X≡1 1⍴MV)/L3                                             ⍝skip if there's nothing there[33]   Z←Z⍪X                                                      ⍝and join them with ours[34]   Z←Z[⍋Z[;1];][35]   B←Z[;1]≠0,¯1↓Z[;1]                                         ⍝we'll take mins and maxes across tiles[36]   Z←(B⌿Z[;1]),(B pMIN Z[;2]),(B pMIN Z[;3]),(B pMAX Z[;4]),[1.5]B pMAX Z[;5][37]  L3:head←1↓⎕TCHT MTOV MATRIFY head[38]   Z TMATOUT F                                                ⍝And write results back out[39]   UNLOCKFILE L[40]   →0[41]  [42]  [43]  what:data prep[44]  type:standard[45]  info:(pathS PATH 'pondids') ('') ('') 1000 'include'      ⍝Source grid, settings table, result grid, buffer size, and include grid[46]  check:CHECKVAR 'big'[47]  init:head←1↓⎕TCHT MTOV MATRIFY 'id xmin ymin xmax ymax' ⋄ (0 0⍴'') TMATOUT pathT PATH 'biglakes.txt' ⍝(Re)create result file on start    ∇