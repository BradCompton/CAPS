    ∇ N LUMP C;X;S;Q;B;head;landcover;loop;test;noread;grids;ffile;N;I;missing;F;warn;fn[1]   ⍝Turn on community lumping for POST for scenario ⍵ & block size ⍺[2]   ⍝Create model\lumping.par (same format at synonyms.par) to specify communities to lump in post-processing[3]   ⍝LUMP creates grids\postland_lumped, model\landcover_lump.par, and model\postmodel_lump.par[4]   ⍝*** Note: The above are hard-wired here, though they aren't in POST.  May want to change this.[5]   ⍝B. Compton 19 Jan 2010 (today Martha Coakley will lose Ted Kennedy's senate seat...or not...)[6]   ⍝7 Apr 2011: modify to use alt = '_lump' in parameters.par[7]   [8]   [9]   [10]   ⍎(0=⎕NC'N')/'N←1000'                           ⍝Block size for reclassyifying land cover[11]  [12]   SETPATHS[13]   INIT[14]   warn←0 ⋄ fn←'LUMP'[15]   S←1 0 TABLE pathI PATH 'lumping.par'           ⍝Read lumping file[16]   S[;1]←S[⌈\Q\(Q←~S[;1]≡¨⊂'')/⍳1↑⍴S;1]           ⍝fill in first column[17]   S←⌽(0≠⊃,/⍴¨S[;2])⌿S                            ⍝drop empty rows: text reclassification table[18]  [19]   X←landcover←TABLE landcoverpar[20]   S←S,X[(TOLOWER¨X[;2])⍳TOLOWER¨S[;1];1]         ⍝Original cover class[21]   S←S,(Q pSUM (⍴Q)⍴1)/(Q←~S[;2]≡¨¯1↓(⊂''),S[;2])/S[;3]   ⍝New cover class[22]  [23]  [24]   B←X[;1]∊S[;3]                                  ⍝Update landcover.par[25]   X[B/⍳1↑⍴X;]←S[S[;3]⍳(B/X[;1]);4 2][26]   X←(X[;1]≠¯1↓0,X[;1])⌿X[27]   head←'class',⎕TCHT,'cover type'[28]   X TMATOUT pathI PATH 'landcover_lump.par'[29]  [30]  [31]   X←(1,⎕TCHT) MATIN pathI PATH 'postmodel.par'   ⍝Update weights file[32]   X←X[;1],0 MVREP 0 1↓X                          ⍝Blanks might as well be zero[33]   Q←LOOKUP (⍳1↑⍴X),[1.5]X[;1][34]   X←Q[;1],X[Q[;2];]                              ⍝Expand to include synonyms[35]   X←X[⍋X[;1];][36]   B←X[;1]∊S[;3][37]   X[B/⍳1↑⍴X;1 2]←S[S[;3]⍳B/X[;1];4 2][38]   B←X[;1]≠¯1↓0,X[;1]        ⍝Mark types to collapse[39]  [40]   Q←(^/~B,[1.5]^/(0 2↓X)=¯1 0↓0⍪0 2↓X)⌿X[;2]     ⍝Warn if information is to be lost[41]   →(0∊⍴Q)/L0[42]   ⎕←'*** Warning: mixed weights found in weights.txt within lumped communities (results are suspect):'[43]   ⎕←' ',' ',' ',(⎕PW-3) TELPRINT MIX ((Q⍳Q)=⍳⍴Q)/Q[44]  [45]  L0:X←B⌿0 1↓X[46]   X TMATOUT pathI PATH 'postmodel_lump.par'[47]  [48]  [49]   F←'postland',⍕C[50]   loop←test←noread←0[51]   grids←0 0⍴''[52]   ffile←'LUMP ',⍕C[53]   BLOCK 2⍴N[54]  [55]   I←0[56]   missing←0 3⍴'' '' 0[57]  L1:X←READ pathG PATH F                          ⍝While we have blocks, read block of landcover[58]   X←(×/Q←⍴X)⍴X[59]   X[B/⍳⍴X]←S[S[;3]⍳(B←(X∊S[;3]))/X;4][60]   X←Q⍴X[61]   X WRITEI pathG PATH F,'_lump'                  ⍝Write reclassified landcover[62]  L4:→(0≠NEXTBLOCK)/L1                            ⍝Until out of blocks[63]  [64]  [65]   ⎕←'Lumping mode set for BENCH and POST.  landcover_lump.par, postmodel_lump.par, and grid ',F,'_lump created.'[66]   ⎕←'*** To use lumping, set alt = ''_lump'' in parameters.par under [post] ***'    ∇