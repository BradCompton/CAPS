    ∇ Z←R MVREP X;I;J;Q;err[1]   ⍝Replace missing values in 1⊃⍵ corresponding to 1's in binary 2⊃⍵ with ⍺ (default = MV)[2]   ⍝If ⍵ is a matrix, look for MVs in it[3]   ⍝Runs APL version if aplc=1, or C version if aplc=2[4]   ⍝B. Compton/E. Ene, 19 Dec 2008[5]   ⍝17 Feb 2010: return integer for integer argument[6]   ⍝8 Oct 2010: separate floating point and integer versions[7]   ⍝27 Aug 2012: make sure MV grid is integer but do it quickly[8]   ⍝20-26 Sep 2012: new version from Edi takes binary template[9]   ⍝22 Oct 2012: fixed bug in higher-dimensional arrays[10]  [11]  [12]  [13]   ⍎(0=⎕NC'R')/'R←MV'[14]   ⍎(2>≡X)/'X←X (X=MV)'           ⍝If passed only 1 matrix, template is X=MV[15]   ⎕ERROR (~≡/⍴¨X)/'MVREP: matrices with different shapes'[16]   →(aplc=1)/L2                   ⍝If C version,[17]   →(3=⎕NC'MVREPc')/L1            ⍝   If not loaded,[18]   Q←⎕EX 'MVREPc'[19]   ⎕ERROR REPORTC 'DLL I4← CAPS_LIB.mvrep_dbl(I4,I4,F8,F8,*F8←,*B1)' ⎕NA 'MVREPc'[20]   ⎕ERROR REPORTC 'DLL I4← CAPS_LIB.mvrep_int(I4,I4,I4,I4,*I4←,*B1)' ⎕NA 'MVREP_Ic'[21]  ⍝⎕←'CAPS_LIB.mvrep loaded.'[22]  [23]  L1:X Z ← X[24]   →(0∊⍴Z)/0[25]   I J ← (1↑⍴X),1⌈×/1↓⍴X          ⍝Make sure we're good for vectors and higher-dimensional arguments[26]   ⍝I J ← ¯2↑1 1,⍴X   FAILS FOR 3 DIMENSIONAL ARRAYS![27]   →(645∊⎕DR¨X R)/L3              ⍝If matrix and replacement are integers,[28]   err Z←MVREP_Ic I J MV R X Z[29]   →L4[30]  [31]  L3:→(323=⎕DR Z)/L5              ⍝If missing value grid is floating point, change it to integer[32]  L5:err Z←MVREPc I J MV R X Z    ⍝Else, floating point version[33]  L4:⎕ERROR REPORTC err[34]   →0[35]  [36]  L2:Z X←X                        ⍝Else, APL version[37]   Z←R UNMV X REMV Z    ∇