    ∇ A LAKESIZES S;buffer;exclude;loop;test;noread;grids;ffile;tilesize;E;Z;N;X;tilemapinclude;skiptilemap;B;head[1]   ⍝Calculate sizes of big lakes for aquatic cores[2]   ⍝Parameters:[3]   ⍝   tilesize            size of tiles (in cells)[4]   ⍝   targets = '1:1'     needs to be in parameters.par to run a single thread[5]   ⍝Runs as a CAPS metric, but only uses one thread.  It'll be fastest if you set host = 'w00'.[6]   ⍝B. Compton, 17 Jun 2016 (from ACORESTATS)[7]   [8]   [9]   [10]   READPARS ME[11]   buffer←4⊃A[12]   exclude←''[13]   loop←test←noread←0 ⋄ grids←0 0⍴''              ⍝Silly junk for BLOCK, etc.[14]   ffile←'LAKESIZES '[15]   BLOCK (2⍴tilesize),buffer[16]   SETTILE[17]  [18]   tilemapinclude←0[19]   skiptilemap←0                                  ⍝Don't let DEBUG sabotage this[20]   E←TILEMAP '' tilesize 0 0                      ⍝Get tilemap, building it if necessary. This will only help if there's mask grid.[21]   ⎕←'Running LAKESIZES on ',(⍕+/E),' tiles' ⋄ FLUSH[22]   Z←0 2⍴0                                        [23]   [24]   N←0[25]  L1:→(~E[N←N+1])/L2                              ⍝Repeat: read tile (1st time through tiles), skip if not in tilemap    --- For each tile ---[26]   BREAKCHECK ⋄ DOT[27]   X←0 MVREP READ 1⊃A                             ⍝   Read pondids[28]   X←(,X≠0)/,X[29]   X←X[⍋X][30]   B←X≠¯1↓0,X[31]   X←(B/X),[1.5]B pSUM (⍴X)⍴1                     ⍝   sizes of lakes in this tile[32]   Z←Z⍪X[33]  L2:→(0≠NEXTBLOCK)/L1                            ⍝   Until no more tiles[34]  [35]   Z←Z[⍋Z[;1];][36]   B←Z[;1]≠¯1↓0,Z[;1][37]   Z←(B/Z[;1]),[1.5]B pSUM Z[;2]                  ⍝Sum sizes of lakes split across tiles[38]   Z←100 2↑Z[⍒Z[;2];]                             ⍝take 100 largest lakes[39]   Z[;2]←Z[;2]÷10000÷cellsize*2                   ⍝convert to ha[40]   head←1↓⎕TCHT MTOV MATRIFY 'pondid size'[41]   Z TMATOUT pathT,'lakesizes.txt'                ⍝and write it out[42]   [43]   ⎕←''[44]   LOG 'LAKESIZES is done.'[45]   →0[46]  [47]  [48]  what:auxiliary[49]  type:table[50]  info:('pondids') ('') ('') 0 ''      ⍝Source grid, settings table, result grid, buffer size, and include grid[51]  check:CHECKVAR 'tilesize targets'    ∇