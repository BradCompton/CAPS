    ∇ R SCRIPT_WEIGHT G;X;M;block;loop;test;grids;noread;E;N;tilemapinclude;dot;skiptilemap;ffile;Z;I;Q;mask;buffer;altmask;L;Y[1]   ⍝Multiply grid 1⊃⍵ by weights in table 3⊃⍵ indexed by class grid 2⊃⍵, tilesize 2⊃⍺; part of the LCD scripting system[2]   ⍝Arguments:[3]   ⍝   ⍺[1]            name of result grid[4]   ⍝   ⍺[2]            tilesize[5]   ⍝   ⍵[1]            names of source grid[6]   ⍝   ⍵[2]            names of index grid (typically landcover classes)[7]   ⍝   ⍵[3]            names weight table (column 1 has values in index grid, column 2 has weights)[8]   ⍝   ⍵[⍴⍵]           name of mask grid[9]   ⍝Launched by SCRIPT_LAUNCH[10]  ⍝Warning: Any values not present in table will result in nodata cells[11]  ⍝You can include nodata cells in table as -9999 to change cells to nodata[12]  ⍝B. Compton, 26 Sep 2014 (from SCRIPT_ADD)[13]  [14]  [15]  [16]   SCRIPTSETUP 'WEIGHT'                           ⍝Set up and set several local variables[17]   L←MATIN 3⊃X                                    ⍝Read weights table[18]  L1:→(~E[N←N+1])/L2                              ⍝Repeat: read tile (skip if not in tilemap)    --- For each tile ---[19]   BREAKCHECK ⋄ DOT[20]   Q←READ 1⊃X                                     ⍝   read source grid[21]   Y←READ 2⊃X                                     ⍝   and index grid[22]   Y←(L[;2],MV)[L[;1]⍳Y]                          ⍝   index weights[23]   Z←MVREP (Q×Y) ((Q=MV)∨Y=MV)                    ⍝   anything missing in either grid is missing[24]   :if ~0∊⍴mask                                   ⍝   If mask grid supplied,[25]      Z←MVREP Z ((READ mask)∊0,MV)                ⍝      read mask & apply it[26]   :end[27]   Z WRITE 1⊃R                                    ⍝   save result[28]  L2:→(0≠NEXTBLOCK)/L1                            ⍝Until no more tiles[29]   ⎕←''    ∇