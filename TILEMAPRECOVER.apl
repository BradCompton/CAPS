    ∇ TILEMAPRECOVER;A;F;X;I;C;V;H[1]   ⍝Recover from a crash in TILEMAP so tilemap.txt isn't left in an indeterminate state[2]   ⍝B. Compton, 9 Jan 2014[3]   ⍝28 Jan 2014: Fixed trapping so it works right[4]   [5]   [6]   [7]    ⎕←'****** Recovering from a crash in TILEMAP ******'[8]    STOP[9]    A F C ⎕ELX ← tilemaprecover[10]  [11]   :if ~A[12]      H←LOCKFILE (1+-(⌽F)⍳'\')↓F                          ⍝Get the lock again[13]   :end[14]  [15]   X←VTOM ⎕TCNL,NREAD F                                   ⍝Read the tilemap file again[16]   X←(~((⊂C)≡¨↓X[;⍳⍴C]))⌿X                                ⍝Find our line and delete it[17]   X←1↓MTOV X[18]   X NWRITE F[19]  [20]   :if ~A[21]      UNLOCKFILE H                                        ⍝   unlock directory[22]   :end[23]  [24]  [25]  ⍝ ('Crash in TILEMAP', ⍕?1E6) GETLOCK 0                  ⍝Temporary code to help with debugging ***[26]  ⍝ STOP    ∇