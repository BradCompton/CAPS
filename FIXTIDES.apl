    ∇ A FIXTIDES S;I;M;W;R;J;dams;targets;E;T;tr;trtable;trx;X;tinywatersheds;lc;result;trs;lrpars;B;d8flow;block;transparent;buffer;stop;tides[1]   ⍝Repair tides settings variable to fix ¯0.5 cells for inland lakes in DEM_NOAA[2]   ⍝⍺ = usual metric left arguments[3]   ⍝⍵ = (start-item number-of-items) (systems)[4]   ⍝Parameters:[5]   ⍝   targets     list of big watersheds for TR[6]   ⍝   stop        stopping rule (use 5)[7]   ⍝BEFOREHAND: must create subtidal is source path, with 1 for subtidal classess and 0 everywhere else[8]   ⍝B. Compton, 21 Apr-4 May 2016 (from TR; Kinder Morgan suspends NED pipeline!)[9]   ⍝30 Aug 2016: copy zeros grid into result at start[10]  [11]  ⍝Note: must run FIXTIDESB as a companion, at the same time[12]  [13]  [14]  [15]   READPARS ME[16]   buffer←4⊃A[17]   M←0 1 1 TABLE pathT PATH targets               ⍝Read TR big watershed table[18]   M←(M[;1]∊(⊃⊃S)+¯1+⍳2⊃⊃S)⌿M                     ⍝Items we're doing[19]   M←0 1↓M                                        ⍝Drop watershed # - we don't care about it[20]  [21]   transparent←3[22]   I←0[23]  L2:→((1↑⍴M)<I←I+1)/0                            ⍝For each watershed,[24]   BREAKCHECK                                     ⍝   Do a single watershed[25]   W←M[I;][26]   W[5 6 7 8]←MER2CELLS W[5 6 7 8]                ⍝Convert MER to cells[27]   W[3 4]←buffer+1+(FINDCELL W[3 4])-W[5 6]       ⍝   Watershed outflow in terms of grid[28]   block←¯1,W[5 6 7 8],buffer                     ⍝   set block to our current window[29]  [30]   X←READ 1⊃1⊃A                                   ⍝   Tides[31]   →(^/,X∊0,MV)/L2                                ⍝   Bail if no tidally-influenced cells[32]   tides←X×X≥0.1                                  ⍝   Use 0.1 as a cutoff for intertidal[33]   lc←READ 2⊃1⊃A                                  ⍝   Landcover[34]   d8flow←READ 3⊃1⊃A                              ⍝   D8 flow accumulation[35]  [36]   ⎕←'Watershed ',(⍕W[1]),'...' ⋄ FLUSH[37]   result←(⍴X)⍴0[38]  ⍝ dams←lc=LOOK 'dam'[39]   [40]   ⍝FIXTIDESr expects globals: result, d8flow, dams[41]   0 FIXTIDESr W[3 4] [42]   [43]   result WRITEI 'Z:\LCC\TEMP\FIXTIDES\result'    ⍝   for testing[44]   (MVREP (result×X) (lc=MV)) WRITE pathR PATH 3⊃A⍝   Write results transparently[45]   →L2[46]  [47]  [48]  [49]  what:CAPS coastal[50]  type:table[51]  info:((⊂pathU PATH 'tides0'),(⊂'land'),⊂pathS PATH 'flow') ('') (⊂pathU PATH 'tides') (1)       ⍝Metric-specific source grids, settings table, result grid, and buffer size[52]  check:CHECKVAR 'targets stop'[53]  check:1 CHECKCOVER 'dam'[54]  check:pathT CHECKFILE targets[55]  init:(GRIDNAME pathS PATH 'subtidal') GRIDCOPY pathU PATH 'tides'           ⍝Copy grid of zeros to result so we don't have MVs in unvisited areas    ∇