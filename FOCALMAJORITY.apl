    ∇ Z←FOCALMAJORITY X;Q;P[1]   ⍝Return most prevalent cell in 3×3 window[2]   ⍝Treat 0 as missing value(!)[3]   ⍝For ties, return lowest value[4]   ⍝11 May 2017: use UNIQUE to run far faster (Liz is 6 days overdue, climbing Mt. Everett!)[5]   [6]   [7]   [8]    →(^/0=Z←X)/0[9]    Q←(,X),(,1 0↓X⍪0),(,¯1 0↓0⍪X),(,0 1↓X,0),(,0 ¯1↓0,X),(,1 1↓(X⍪0),0),(,1 ¯1↓0,X⍪0),(,¯1 1↓(0⍪X),0),[1.5],¯1 ¯1↓0,0⍪X[10]   P←(P≠0)/P←UNIQUE ,X[11]   P←P[⍋P][12]   Q←+/P∘.=Q[13]   Z←(⍴X)⍴((+⌿^⍀Q≠(⍴Q)⍴⌈⌿Q)⌽(⌽⍴Q)⍴P)[;1]    ∇