    ∇ S POSTBY P;M;I;E;X;B;Y;G;Z;Q;t;landcover;F;T;N;dot[1]   ⍝Rescale IEI by ⍵ (typically ecoregion or watershed) for scenario ⍺ (typically '')[2]   ⍝If ⍵ is grid name, result is IEI_1↑⍵, if it contains a colon, use part before colon for name, e.g. e:ecoregions or ct:connecticut[3]   ⍝Source data:[4]   ⍝   grids\[5]   ⍝       landcover[6]   ⍝       source grid (e.g., ecoregion, watershed)[7]   ⍝       <poly>s_box.txt, from polybox.aml[8]   ⍝   post\scaled\[9]   ⍝       iei[10]  ⍝Globals:[11]  ⍝   grid            name of landcover grid[12]  ⍝   weights         table of community classes and metric weights[13]  ⍝   qtiles          number of quantiles[14]  ⍝Results:[15]  ⍝   post\scaled\[16]  ⍝       iei_<poly>  IEI, rescaled by polys[17]  ⍝* Note: this version doesn't use benchmarks, and won't work for huge watersheds/ecoregions[18]  ⍝* And note: you'll need to run fixecoshed.aml - FIXECOSHED - fixecoshed2.aml for ecoregions and watersheds, or[19]  ⍝  polybox.aml for other input coverages (but beware of lapping failures)[20]  ⍝B. Compton, 28-29 May 2009[21]  ⍝1 Feb 2010: add lumping[22]  ⍝11 Feb 2011: use transparent grid writing.  Mubarak steps down in Egypt after 17 days of escalating nonviolent protests.[23]  ⍝8 Mar 2011: Oops...get landcover grid name from post.txt[24]  ⍝28 Mar-7 Apr 2011: revisions for new POST[25]  [26]  [27]  [28]   ⍎(0=⎕NC'S')/'S←'''''[29]   Q←(Q≤⍴P)×Q←P⍳':'                               ⍝Decode result:grid[30]   N←(1⌈Q-1)↑P                                    ⍝Result name[31]   P←FRDBL Q↓P[32]  [33]   M←MATIN pathG PATH P,'_box.txt'[34]   M[;2 3]←↑FINDCELL¨↓M[;2 3]                     ⍝Convert to cells[35]   M[;4 5]←↑FINDCELL¨↓M[;4 5][36]   M←M[;4 3 2 5]                                  ⍝Rearrange into upper left R,C, lower right[37]   M[;3 4]←1+M[;3 4]-M[;1 2]                      ⍝Upper left, number of cells[38]   M[;1 2]←1⌈M[;1 2]                              ⍝If off edge of grid, correct it[39]  [40]   G←(∨/0≠0 1↓weights)/weights[;1]                ⍝Communities in play[41]   GRIDKILL results,'iei_',N[42]   LOG 'POSTBY: ',(TOUPPER P[1]),(TOLOWER 1↓P),', ',(⍕1↑⍴M),' polys' ⋄ FLUSH[43]   I←0[44]  L1:→((1↑⍴M)<I←I+1)/L3                           ⍝For each polygon,[45]   DOT[46]   Y←READBLOCK (⊂pathG PATH P),M[I;][47]   B←,Y=I[48]   X←B/,READBLOCK (⊂grid),M[I;][49]   E←B/,READBLOCK (⊂results,'iei'),M[I;][50]   Z←((~B)\MV)+B\G qtiles QUANTILESG E X[51]   Z←(⍴Y)⍴Z[52]   Z WRITEBLOCK (⊂results,'iei_',N),M[I;],0 1  ⍝Write transparently[53]   →L1[54]  [55]  L3:⎕←''    ∇