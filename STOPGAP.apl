    ∇ STOPGAP;Y;C;Z;I;H;Q;X;landcover;M;T[1]   ⍝Make stopgap settings grids for community-based runs of connectedness and similarity[2]   ⍝B. Compton, 20 Mar 2008 (1st day of spring, supposedly)[3]   ⍝Updated 23 Feb 2009 to use new landcover table and model directory[4]   ⍝20 Mar 2009: more updates (spring equinox)[5]   ⍝21 May 2009: only drop systems column if it exists![6]   ⍝3 Aug 2009: bug in dropping systems column; use standardize01.aml[7]   ⍝20 and 23 Aug 2010: update for CAPS 3.0[8]   ⍝7 Mar 2011: Use paths; give warning, not error for missing types in landcover[9]   ⍝12 Mar 2012: allow luwet to be redirected in inputs.par[10]  ⍝30 Jan 2014: use new INIT[11]  [12]  [13]  [14]   INIT[15]   Y←⍕¨(1 ⎕TCHT) MATIN pathI PATH 'stopgap.txt'[16]   Y←(0,T←('system')≡FRDBL TOLOWER (⎕TCHT MATRIFY head)[1;])↓Y    ⍝Drop systems column if it exists[17]   H←TOLOWER ((T+1),0)↓⎕TCHT MATRIFY head[18]   Y←Y[;1],(⎕FI¨0 1↓Y)+MV×~⎕VI¨0 1↓Y              ⍝Replace missing values (*) with MV[19]   Q←LOOKUP (⍳1↑⍴Y),Y[;,1][20]   Z←Q[;1],0 1↓Y[Q[;2];][21]   Z←Z[⍋Z[;1];][22]   Z←(B←(~Z[;1]≡¨¯1⌽Z[;1]))⌿Z[23]   ⎕←(0∊B)/'*** WARNING: duplicated landcover types in stopgap table (perhaps from synonyms?)'[24]   Z←(⊃¨Z)+⊃¨MV×Z≡¨⊂⍳0                            ⍝and replace missing cells with MV[25]  [26]   M←(~landcover[;1]∊Z[;1])⌿landcover[;2]         ⍝missing landcover types[27]   →(0∊⍴M)/L0[28]   C←ifchat ⋄ ifchat←1[29]   LOG '*** WARNING: landcover types missing from stopgap table:'[30]   LOG MTOV ' ',' ',' ', (⎕PW-3) TELPRINT MIX M[31]   LOG ''[32]  [33]  L0:X←'⋄' MATRIFY '/* stopgap.aml⋄/* Automatically generated by STOPGAP, ',NOW,'⋄ ⋄ '[34]   X←X OVER 'w ',pathU[35]   X←X OVER '&r kill',' 'MTOV H[36]   X←X OVER 'grid'[37]   X←X OVER MIX(FRDBL¨↓H),¨((⊂' = reclass(',(pathS PATH GRIDNAME 'luwet'),', ')),¨(FRDBL¨↓H),¨⊂'.txt, nodata)'[38]   X←X OVER 'q'[39]   X NWRITE pathU PATH 'stopgap.aml'[40]  [41]   ⎕←'Writing files:'[42]   I←0[43]  L1:→((1↑⍴H)<I←I+1)/L2       ⍝For each output file,[44]   Q←(⊃,/Z[;I+1]≠MV)⌿Z[;1,I+1][45]   Q←MIX DEB¨↓(⍕Q[;,1]),' ',':',' ',⍕Q[;,2][46]   Q NWRITE FRDBL ⎕←' ',' ',' ',pathU PATH (FRDBL H[I;]),'.txt'[47]   →L1[48]  [49]  L2:⎕←'Now, in Arc, &r ',pathU PATH 'stopgap'    ∇