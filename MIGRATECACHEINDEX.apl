    ∇ MIGRATECACHEINDEX;X;X_;Y;P;I;head;D;K;H[1]   ⍝Migrate old single cache index to new hashed cacheindices[2]   ⍝MUST BE RUN WITH NOTHING ELSE TOUCHING CACHE![3]   ⍝B. Compton, 16 May 2016[4]   ⍝19 May 2016: drop columns we don't want any more[5]   ⍝25 May 2016: create cacheinfo.txt and rename the old index[6]   [7]   [8]   [9]    GETCACHECONFIG[10]   X X_ ← GETTABLE (2⊃cache),'gridcache.txt'   ⍝Read old-style grid cache diretory[11]   X←X[;X_ COL K←'source cache status cachedate sourcedate reads size'][12]   X_←MATRIFY K[13]   [14]   Y←1 GETCACHEPATH¨X[;1]                     ⍝Get hashes[15]   head←1↓⎕TCHT MTOV X_[16]   1 MAKEDIR D←(2⊃cache),'index\'[17]  [18]   H←⌈/0,⊃,/⎕FI¨STRIP¨(-1+⍴¨STRIP¨H)↓¨H←X[;X_ COL 'cache'][19]   H←H,+/X[;X_ COL 'size'][20]   ((⍕H[1]),⎕TCNL,⍕H[2]) NWRITE (2⊃cache),'index\cacheinfo.txt'          ⍝Create cacheinfo.txt[21]  [22]  I←0[23]  L1:→(cache[5]<I←I+1)/L2                     ⍝For each index,[24]   ((Y=I)⌿X) TMATOUT D,(⍕I),'.txt'[25]   →L1[26]   [27]  L2:3 ⎕CMD 'rename ',((2⊃cache),'gridcache.txt'),' old_gridcache.txt'[28]   ⎕←'New caches created.'    ∇