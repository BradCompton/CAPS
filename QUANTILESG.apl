    ∇ Z←G QUANTILESG X;B;X;G;I;M;Q;J;A;V;Y;L[1]   ⍝Rescale vector ⍵[1] by quantiles 2⊃⍺, within groups marked by ⍵[2]; use only groups in vector 1⊃⍺[2]   ⍝New double-looping version works for huge grids[3]   ⍝B. Compton, 29 May 2009, from QUANTILESC[4]   ⍝28 Mar 2011: use qtiles instead of assuming percentiles[5]   [6]   [7]    Y X ← X                        ⍝Values (iei), groups (flc)[8]    G L ← G                        ⍝groups to do, number of quantiles[9]    B←(X∊G)^X≠MV                   ⍝Only do these[10]   X←B/X[11]   Z←B/Y[12]   →(0∊⍴Z)/L4[13]   M←(÷L)×¯1+⍳L[14]  [15]   I←0[16]  L1:→((⍴G)<I←I+1)/L4             ⍝For each group[17]   V←(X=G[I])/Z[18]   Q←M QTILE V[19]   A←J←0[20]  L2:→((⍴M)<J←J+1)/L3             ⍝   For each n-tile,[21]   A←A+V≥Q[J][22]   →L2[23]  L3:Z[(X=G[I])/⍳⍴Z]←M[1⌈A][24]   →L1[25]  [26]  L4:Z←((~B)\MV)+B\Z              ⍝Puff result back up    ∇