    ∇ Z←F DOWNFLOW X;Q[1]   ⍝Give value in ⍵ of cells immediately downstream from each cell in flow grid ⍺ (matrix version of NEXTFLOW)[2]   ⍝Global: fd[3]   ⍝B. Compton, 10 Dec 2004; modified 12 Oct 2010[4]   ⍝26 Feb 2014: if source grid is all 0, don't go to any trouble[5]   [6]   [7]   [8]    →(^/0=,Z←X)/0[9]    X←0,0⍪(X⍪0),0[10]   Z←0⍪0 1 1↓0 ¯1 ¯1↓(1⌽X)⍪(1⌽1⊖X)⍪(1⊖X)⍪(¯1⌽1⊖X)⍪(¯1⌽X)⍪(¯1⌽¯1⊖X)⍪(¯1⊖X)⍪[.5]1⌽¯1⊖X[11]   Q←9|fd[;1]⍳F[12]   Z←(Q⌽[1]Z)[1;;]    ∇