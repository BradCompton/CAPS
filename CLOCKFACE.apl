    ∇ Z←W CLOCKFACE G;X;QX;T;I;J;L;D;Q;M;K;Y;C;S[1]   ⍝Find lines in grid ⍵ using clockfacing algorithm with window, hit proportion, and cell thresholds ⍺; return success flag[2]   ⍝⍵ can be 'grid result' if you want to specify result grid[3]   ⍝Clockfacing tries to match candidate vectors to high values in input grid, bridging gaps in lines[4]   ⍝These shapes are tried: line, corner, T, cross, line end[5]   ⍝B. Compton, 22 Nov 2016 (on-demand hot water is going in!)[6]   ⍝16 Dec 2016: return success flag[7]   ⍝19 Dec 2016: require at least 20 cells for success[8]   ⍝20 Dec 2016: don't include original grid in result--it contains too much noise[9]   [10]  [11]  [12]   ⍎(0=⎕NC'W')/'W←⍳0'[13]   W←3↑W,(⍴,W)↓11 0.5 1               ⍝Defaults: window of 11, hit proportion of 0.5, cell threshold of 1[14]   C←⌊W[1]÷2                          ⍝Center point--we'll use this a lot[15]  ⍝ INIT[16]   G←MATRIFY G[17]   G←G OVER (FRDBL G[1;]),'_c'        ⍝Default result is input_c[18]   G←(FRDBL G[1;]) ((STRIPPATH G[1;]) PATH FRDBL G[2;])[19]   ∆GRIDINIT ''[20]   ∆SETWINDOW 1⊃G[21]   X←0 MVREP ∆READGRID 1⊃G[22]  [23]   L←(0,2⍴W[1])⍴0[24]  [25]   ⍝Build stack[26]   Q←W[1 1]⍴0[27]   Q[;C+1]←1                          ⍝Line[28]   L←L⍪↑(W[1] INTERVALS 0.5) ROTATE¨⊂Q[29]  [30]   Q←W[1 1]⍴0[31]   Q[C↓⍳1↑⍴Q;C+1]←1                   ⍝Line end[32]   L←L⍪↑(W[1] INTERVALS 1) ROTATE¨⊂Q[33]   [34]   Q←W[1 1]⍴0[35]   Q[C↓⍳1↑⍴Q;C+1]←1                   ⍝Corner[36]   Q[C+1;C↓⍳1↓⍴Q]←1[37]   L←L⍪↑(W[1] INTERVALS 1) ROTATE¨⊂Q[38]  [39]   Q←W[1 1]⍴0[40]   Q[C↓⍳1↑⍴Q;C+1]←1                   ⍝T[41]   Q[C+1;]←1[42]   L←L⍪↑(W[1] INTERVALS 1) ROTATE¨⊂Q    [43]  [44]   Q←W[1 1]⍴0[45]   Q[;C+1]←1                          ⍝Cross[46]   Q[C+1;]←1[47]   L←L⍪↑(W[1] INTERVALS 0.5) ROTATE¨⊂Q[48]  [49]   S←+/+/L                            ⍝Max score for each shape[50]  [51]  [52]   D←(⍳W[1])-C+1                      ⍝Index vector[53]   X←T,X,T←((1↑⍴X),C)⍴0               ⍝Pad data by half of window[54]   X←T⍪X⍪T←(C,1↓⍴X)⍴0 [55]   Y←(⍴X)⍴0[56]  [57]  [58]   I←C[59]  L1:→(((1↑⍴X)-C)<I←I+1)/L3           ⍝For each row,[60]   DOT[61]   J←C[62]  L2:→(((1↓⍴X)-C)<J←J+1)/L1           ⍝   For each column,[63]   →(X[I;J]<W[3])/L2                  ⍝      If cell is below cell threshold, skip it[64]   Q←X[I+D;J+D]                             [65]   →(W[2]>+/,Q)/L2                    ⍝      If window can't reach threshold, skip it[66]   M←+/+/L×(⍴L)⍴Q                     ⍝         clockfaces × weights[67]   M←(M≥W[2])×M←M÷S                   ⍝         scores in terms of proportion for each shape, only those above threshold[68]   K←(M=⌈/M)⍳1                        ⍝         (first) best face[69]   Y[I+D;J+D]←Y[I+D;J+D]⌈L[K;;]×M[K]  ⍝         save result[70]   →L2[71]   [72]  L3:Y←(2⍴C)↓(-2⍴C)↓Y[73]   Y←⌊.5+Y                            ⍝Integerize[74]   Y ∆WRITEGRID 2⊃G[75]  [76]   Z←20≤+/,Y                          ⍝Return success flag (require at least 20 cells)[77]  [78]   ⎕←⎕TCNL,'CLOCKFACE is done (',((Z+1)⊃'failure' 'success'),'); results are in ',2⊃G    ∇