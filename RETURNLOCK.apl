    ∇ RETURNLOCK X;T;R;M;A;Q;err[1]   ⍝Return lock for key, thread/requestor, message ⍵[2]   ⍝Arguments:[3]   ⍝   ⍵[1] = key          directory or key (default = pathA)[4]   ⍝   ⍵[2] = thread       id of the current thread / requestor name (default = name.thread)[5]   ⍝   ⍵[3] = message      message for lock server & log[6]   ⍝Globals:[7]   ⍝   pathA               default cluster path; used if not passed in ⍺[8]   ⍝   name                computer name[9]   ⍝B. Compton, 12 Feb 2013, from UNLOCKDIR and previous version of RETURNLOCK (11-16 Jan 2013)[10]  ⍝11 Oct 2013: make sure thread is text![11]  ⍝9 Dec 2013: exit if ~cluster[12]  [13]  [14]  [15]   :if (0≠⎕NC 'cluster')              ⍝If cluster exists, exit if ~cluster[16]      →(~cluster)/0[17]   :end[18]  [19]   ⍎(1≥≡X)/'X←,⊂X'[20]   T←'0' ⋄ ⍎(0≠⎕NC'thread')/'T←thread'[21]   A R M ← 3↑X,(⍴,X←((X≡,⊂,0)∨X≡,0)↓X)↓pathA T ''[22]  [23]   →uselockserver/L1                          ⍝If uselockserver = 0,[24]   A UNLOCKDIR 0[25]   →0                                         ⍝Else,[26]  [27]  L1:⍎((0≠⎕NC'computername')^0=1↑0⍴R)/'R←computername,''.'',⍕R'⍝   default requestor[28]   R←⍕R[29]   ⍎(0∊⍴M)/'M←1↓FIRSTCOL STRIP ⎕WSID'         ⍝   default message[30]   M←M,' (APL)'                               ⍝   append (APL) to message[31]  [32]   →(3=⎕NC'RETURNLOCKc')/L2                   ⍝   If not loaded,[33]   Q←⎕EX 'RETURNLOCKc'[34]   ⎕ERROR REPORTC 'DLL I4←LOCK_LIB.release_lock(*C1,*C1,*C1)' ⎕NA 'RETURNLOCKc'[35]  [36]  L2:⍝⎕←'   [Returning lock]' ⋄ FLUSH[37]   err←RETURNLOCKc (FRDBL A) R M,¨⎕TCNUL[38]   ⎕ERROR REPORTC err    ∇