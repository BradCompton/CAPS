    ∇ S MAKEDIR_THAT_WORKED D;P;T;Q[1]   ⍝Create new directory ⍵, creating parent directory if necessary. Get lock, but suppress locking if ⍺.[2]   ⍝B. Compton, 5 May 2011[3]   ⍝21 Nov 2013: check for collisions[4]   ⍝27 Mar 2014: do several tries in IFEXISTS before throwing an error[5]   ⍝31 Mar-1 Apr 2014: that didn't work. Use Ethan's approach of locking the containing directory[6]   ⍝2 Apr 2014: a different approach[7]   ⍝3 Apr 2014: and yet a different one...this might work[8]   [9]   [10]  [11]   ⍎(0=⎕NC'S')/'S←0'[12]   D←(-'\'=¯1↑D)↓D←FRDBL D[13]   →(IFEXISTS D,'\')/0                        ⍝If directory already exists, exit[14]   :if ~IFEXISTS P←(-¯1+(⌽D)⍳'\')↓D           ⍝If parent directory doesn't exist,[15]      MAKEDIR P                               ⍝   Create it, recursively[16]   :end[17]  [18]   :if ~S[19]      Q←LOCKFILE D,'\'                        ⍝   Lock the directory (unless suppressed)[20]   :end[21]   :if IFEXISTS D,'\'                         ⍝If it exists now,[22]      →S/0[23]      UNLOCKFILE Q                            ⍝   Success[24]      →0[25]   :end                                       ⍝Else,[26]  [27]  [28]   T←TRY '⎕MKDIR D'                                ⍝   Create directory[29]   T←⎕DL 0.1[30]   ⎕←'Creating directory ',D,'\' ⋄ FLUSH[31]   :if ~S[32]      UNLOCKFILE Q[33]   :end[34]   →(60 WAITUNTILEXISTS D,'\')/0              ⍝Wait a whole minute for directory to be created before throwing error[35]  [36]  ('Crash in MAKEDIR at ',((1+NOW⍳',')↓NOW),' (',(⍕?1E3),')') GETLOCK 0                  ⍝Temporary code to help with debugging ***[37]  STOP[38]  [39]   ⎕ERROR 'MAKEDIR failed to create directory ',D,'\'    ∇