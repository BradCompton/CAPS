    ∇ Z←O FD8FLOW X;Y;V;M;F;D;L;I;G;P;A;T;R[1]   ⍝Calculate flow accumulation for DEM, D8 flow direction, D8 flow accumulation and precip ⍵ using FD8 (multiple flow path) algorithm, starting at outflows ⍺[2]   ⍝Parameters:[3]   ⍝   Depressionless DEM (use FILL in Arc/Grid) ← If not depressionless, all bets are off![4]   ⍝   D8 flow direction grid (from FLOWDIRECTION in Arc/Grid)[5]   ⍝Reference: Wilson and Gallant (2000)[6]   ⍝B. Compton, 24 Sep-28 Oct 2009 (from FLOWACCUM in TOPO, 7-13 Mar 2008) and 27 May 2010 (from NEWFLOW)[7]   ⍝1 Sep 2011: add precipitation[8]   [9]   [10]  [11]   X Y A R ← X[12]   V←1.1                   ⍝Flow concentration constant[13]   X←(1+⌈/,X) MVREP X      ⍝Nodata DEM cells are higher than landscape--edges flow inwards[14]   X←0⍪(0,X,0)⍪0[15]   Y←0⍪(0,Y,0)⍪0[16]   R←1⍪(1,R,1)⍪1[17]   G←(2*0,⍳7)∘.=Y          ⍝D8 flow directions (from Arc flow grid)[18]  [19]  [20]  [21]  ⍝Step one: calculate flow directions using FD8[22]  ⍝This is split up to keep from filling memory; it can be done in tiles[23]   F←X-1⌽X                 ⍝Flow from focal to east[24]   F←F,[.5]X-1⌽1⊖X         ⍝   southeast[25]   F←F⍪X-1⊖X               ⍝   south[26]   F←F⍪X-¯1⌽1⊖X            ⍝   southwest[27]   F←F⍪X-¯1⌽X              ⍝   west[28]   F←F⍪X-¯1⌽¯1⊖X           ⍝   northwest[29]   F←F⍪X-¯1⊖X              ⍝   north[30]   F←F⍪X-1⌽¯1⊖X            ⍝   northeast[31]   L←∨⌿F=0                 ⍝   Mark flat cells--we'll use D8 for them[32]   L←L∨0⍪0,((A≥d8threshold×1E4÷cellsize*2),0)⍪0    ⍝   Mark streams with large watersheds--we'll use D8 for these too[33]   L[1,1↑⍴L;]←L[;1,1↓⍴L]←0 ⍝   but not borders[34]  [35]   F[;1,1↑⍴X;]←F[;;1,1↓⍴X]←0⍝   and clear borders in flow[36]   F←F÷⍉(⌽⍴F)⍴1 2*.5       ⍝   Slope is less steep at corners, because it's farther![37]   F←((0⌈F)÷cellsize)*V[38]   F←F DIV(⍴F)⍴+⌿F[39]  [40]  ⍝Step two: replace cells in perfectly flat areas and higher-order streams with D8 flows[41]   F←,F[42]   F[T]←(,G)[T←((8××/⍴X)⍴L)/⍳×/⍴F][43]   F←(8,⍴X)⍴F[44]  [45]  ⍝Step three: rotate flow grids to represent flow into each focal cell[46]   F[1;;]←¯1⌽F[1;;]        ⍝Flow from west to focal[47]   F[2;;]←¯1⊖¯1⌽F[2;;]     ⍝   northwest[48]   F[3;;]←¯1⊖F[3;;]        ⍝   north[49]   F[4;;]←¯1⊖1⌽F[4;;]      ⍝   northeast[50]   F[5;;]←1⌽F[5;;]         ⍝   east[51]   F[6;;]←1⊖1⌽F[6;;]       ⍝   southeast[52]   F[7;;]←1⊖F[7;;]         ⍝   south[53]   F[8;;]←1⊖¯1⌽F[8;;]      ⍝   southwest[54]  [55]  ⍝Step four: calculate flow accumulation[56]   Z←R                     ⍝Result (use precip if passed)[57]   D←0,(0⍪((¯2+⍴X)⍴0)⍪0),0 ⍝Done flag[58]  [59]   I←0[60]  L1:P←(⍴X)⍴0              ⍝Pending flag to catch infinite loops due to D8 flow errors[61]   →((1↑⍴O)<I←I+1)/L2      ⍝For each target cell,[62]   BREAKCHECK[63]   FD8FLOW2 O[I;]+1        ⍝   Call recursive flow accumulation function[64]   →L1[65]  L2:Z←MVREP Z (~D)        ⍝   unvisited cells → NODATA[66]   Z←1 1↓¯1 ¯1↓Z    ∇