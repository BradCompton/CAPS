    ∇ Z←FOCALMAX X;I[1]   ⍝Return 3×3 focal max neighbor value of each cell[2]   ⍝Uses global KK8 8-neighbor rule[3]   ⍝11 Sep 2012: respect nodata cells (a crystal clear Tuesday in mid-September...)[4]   [5]   [6]    ⍎(0=⎕NC'KK8')/'KK8←8 2⍴¯1 0 1 0 0 ¯1 0 1 ¯1 ¯1 1 1 ¯1 1 1 ¯1'[7]   [8]    X←(-2+⍴X)↑(1+⍴X)↑X[9]    Z←X[10]   I←0[11]  L1:→((1↑⍴KK8)<I←I+1)/L2[12]   Z←Z⌈(KK8[I;1]⌽KK8[I;2]⊖X)[13]   →L1[14]  L2:Z←¯1 ¯1↓1 1↓MVREP Z (X=MV)    ∇