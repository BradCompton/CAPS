    ∇ Z←NPK2;C;V;I;J;E;head;F;N;X;A;W;Q;area_km;V2;V3;V4;V5;V6;V7;V8;V9;V10;V11;V12;V13;V1;T;area_kmi;O;Y[1]   ⍝CAPS 3.0 nutrient enrichment metrics (nitrogen + phosphorus, part 2 (calculate results)[2]   ⍝Global variables (set by WATERSHED/WATERSHEDB):[3]   ⍝   tmin_iv         Minimum annual temperature [4]   ⍝   precip_iv       Annual precip[5]   ⍝   impervi_iv      Imperviousness [6]   ⍝   discharge_iv    Water discharges[7]   ⍝   septic_iv       Percent of households on septic (1990 census data)[8]   ⍝   cropland_iv     Percent of the landscape in crops...[9]   ⍝   cranberry_iv    ...in cranberry bogs[10]  ⍝   forest_iv       ...in forest[11]  ⍝   fowet_iv        ...in forested wetlands[12]  ⍝   deepmarsh_iv    ...in deep marsh[13]  ⍝   urbanopen_iv    ...in urban open[14]  ⍝   lowland_iv      ...in nonforested wetlands[15]  ⍝Global variables are all within-Massachusetts only, and all use kernel influence.[16]  ⍝Requires regression parameters in caps\project\npk_betas.txt. 1st column is N or P.[17]  ⍝*** Warning! This metric deletes intermediate variables--make sure they are not used by any new watershed metrics I implement![18]  ⍝B. Compton, 19 May-4 Jun 2015 (from HA2)[19]  ⍝8 Jun 2015: return log of ecochange; exclude Cape & islands[20]  [21]  [22]  [23]   C←TABLE path,'project\npk_betas.txt'           ⍝Read betas (these are combined betas and gammas from Table 2 of Homa et al. (2013)[24]   E←C[;1] ⋄ C←0 1↓C                              ⍝Metric - N or P[25]   V←1 0↓TOLOWER ',' MATRIFY head                 ⍝Variable names[26]   W←V MATIOTA MATRIFY 'impervini dischargeni septic urbanopen cropland cranberry'  ⍝Anthropogenic variables[27]  [28]   T←⎕EX 'impervini_s discharge_s septic_s cropland_s cranberry_s forest_s fowet_s deepmarsh_s urbanopen_s lowland_s' ⍝Free up space[29]  [30]   X←(1↑⍴V)⍴0                                     ⍝Vector for transformed variables[31]   O←size≠MV                                      ⍝To set everything outside of watershed to zero (prevents LIMIT ERRORS later)[32]  [33]   Q←suminf-mininf×size[34]   X[1]←⊂O×(⍴size)⍴1                                                  ⍝Intercept   [35]   X[2]←⊂O×LN ((tmin_iv-mininf×tmin_v) DIV Q)+15                      ⍝Minimum annual temperature + offset of 15                            [36]   X[3]←⊂O×LN 1+(precip_iv-mininf×precip_v) DIV Q                     ⍝Annual precip                                       [37]   T←⎕EX 'precip_v precip_iv'                                         ⍝Free up space as we go--it's tight[38]   X[4]←⊂O×LN 1+(impervini_iv-mininf×impervini_v) DIV Q               ⍝Imperviousness                                      [39]   T←⎕EX 'impervini_v impervini_iv'[40]   X[5]←⊂O×LN 1+100×365×(dischargeni_iv-mininf×dischargeni_v) DIV Q   ⍝Water discharges (convert units from d → y, and by percent)[41]   T←⎕EX 'dischargeni_v dischargeni_iv'[42]   X[6]←⊂O×LN 1+(septic_iv-mininf×septic_v) DIV Q                     ⍝Percent of households on septic (1990 census data)  [43]   T←⎕EX 'septic_v septic_iv'[44]   X[7]←⊂O×LN 1+100×(cropland_iv-mininf×cropland_v) DIV Q             ⍝Percent of the landscape in crops...                [45]   T←⎕EX 'cropland_v cropland_iv'[46]   X[8]←⊂O×LN 1+100×(cranberry_iv-mininf×cranberry_v) DIV Q           ⍝...in cranberry bogs                                [47]   T←⎕EX 'cranberry_v cranberry_iv'[48]   X[9]←⊂O×LN 1+100×(forest_iv-mininf×forest_v) DIV Q                 ⍝...in forest                                        [49]   T←⎕EX 'forest_v forest_iv'[50]   X[10]←⊂O×LN 1+100×(fowet_iv-mininf×fowet_v) DIV Q                  ⍝...in forested wetlands                             [51]   T←⎕EX 'fowet_v fowet_iv'[52]   X[11]←⊂O×LN 1+100×(deepmarsh_iv-mininf×deepmarsh_v) DIV Q          ⍝...in deep marsh                                    [53]   T←⎕EX 'deepmarsh_v deepmarsh_iv'[54]   X[12]←⊂O×LN 1+100×(urbanopen_iv-mininf×urbanopen_v) DIV Q          ⍝...in urban open                                    [55]   T←⎕EX 'urbanopen_v urbanopen_iv'[56]   X[13]←⊂O×LN 1+100×(lowland_iv-mininf×lowland_v) DIV Q              ⍝...in nonforested wetlands                          [57]   T←⎕EX 'lowland_v lowland_iv'[58]  [59]   I←0[60]   Z←(⍴E)⍴0[61]  L2:→((⍴E)<I←I+1)/0                              ⍝For each nutrient,[62]   A←N←(⍴size)⍴0                                  ⍝   Fresh anthro (total) and natural predictions for this nutrient[63]  [64]   J←0[65]  L3:→((1↑⍴V)<J←J+1)/L4                           ⍝   For each variable,[66]   →(C[I;J]=0)/L3                                 ⍝      Skip if not used for this model[67]   :if J∊W                                        ⍝      If anthropogenic variable,[68]      A←A+C[I;J]×J⊃X                              ⍝      add to anthro prediction[69]   :else                                          ⍝      Else, natural variable[70]      N←N+T←C[I;J]×J⊃X                            ⍝      add to natural prediction[71]      A←A+T                                       ⍝      and to anthro prediction[72]   :end[73]   →L3[74]  [75]  L4:[76]   (MVREP (0⌈A) ((~streams)∨size=MV)) WRITE pathW,'LN-TOTAL-',I⊃E     ⍝   Write LN total amount for nutrient ***[77]   (MVREP (0⌈N) ((~streams)∨size=MV)) WRITE pathW,'LN-NATURAL-',I⊃E   ⍝   Write LN natural amount for nutrient ***[78]  [79]   Y←⍟1+100×|((*A)-*N) DIV *N                     ⍝   Ecochange for this nutrient - delta over natural (use ln(ecochange+1)[80]   Z[I]←⊂(MVREP Y ((capeless=MV)∨(~streams)∨size=MV))   ⍝   Replace missing values and only return values for streams; exclude Cape & islands[81]   →L2    ∇