    ∇ POSTI S;loop;test;noread;N;grids;ffile;I;X;block;t;E;Y;W;A;D;systems;B;Z;J;Q;landcover;T;F;R;dot;M[1]   ⍝Create integrated IEI for scenario ⍵ (typically '')[2]   ⍝Source data:[3]   ⍝       landcover (as with other POST functions)[4]   ⍝   (results)\[5]   ⍝       iei     IEI[6]   ⍝       iei_e   IEI, rescaled by ecoregion[7]   ⍝       iei_w   IEI, rescaled by watershed[8]   ⍝Results:[9]   ⍝   (results)\[10]  ⍝       rawiei_i   RAW integrated IEI (rescaled by ecoregion for T, watershed for others); needs BENCH/POST cycle[11]  ⍝Note: requires groups '(u)pland' and 'wetland & (a)quatic' to be defined in groups.par.[12]  ⍝  * This, of course, doesn't really make sense when doing gradient rescaling[13]  ⍝    I could, I suppose, figure out how wet or dry each cluster is....but probably we'll[14]  ⍝    just skip POSTI when doing gradient rescaling.[15]  ⍝B. Compton, 1 Jun 2009[16]  ⍝1 Feb 2010: add lumping[17]  ⍝7 Feb 2011: go from systems → groups[18]  ⍝3 Mar 2011: Oops...get landcover grid name from post.txt[19]  ⍝6-7 Apr 2011: rewrite for new POST scheme[20]  ⍝29 Jun 2011: bug in TILEMAP[21]  ⍝27 Jan 2014: use SETTILE instead of noread←1 nonsense[22]  [23]  [24]  [25]   R←results,((~0∊⍴⍕S)/(⍕S),'\')[26]   landcover←TABLE landcoverpar[27]   D←(D∊weights[;1])/D←(0 'groups.par' LOOKUP 1 2⍴0,'U')[;1]⍝Dry, use ecoregions[28]   A←(A∊weights[;1])/A←(0 'groups.par' LOOKUP 1 2⍴0,'A')[;1]⍝Aquatic/wetlands, use watersheds[29]   ⎕ERROR (∨/A∊D)/'Error: one or more communities are in multiple upland/aquatic groups!'[30]  [31]   GRIDKILL R PATH 'rawiei_i'             ⍝Drop old grid[32]  [33]   loop←test←noread←0                     ⍝Silly junk for BLOCK, etc.[34]   grids←0 0⍴''[35]   ffile←'POSTI'[36]   BLOCK 2⍴blocksize[37]   SETTILE[38]   M←TILEMAP grid blocksize 0[39]  [40]   LOG'POSTI: Processing ',(⍕+/M),' tiles (',(⍕block[6]),'x',(⍕block[7]),')'[41]  [42]   I←0[43]  L1:→(~M[I←I+1])/L2                      ⍝   Skip if not in block map[44]   DOT[45]   Q←⍴X←READ grid                         ⍝While we have blocks, read block of landcover,[46]   X←(B←,X∊weights[;1])/,X[47]   Y←B/,READ R PATH 'iei'                 ⍝   and various IEIs[48]   W←B/,READ R PATH 'iei_w'[49]   E←B/,READ R PATH 'iei_e'[50]   Z←(⍴X)⍴0[51]  [52]   J←(X∊D)/⍳⍴X                            ⍝   Index dry points[53]   Z[J]←Y[J]⌈E[J]                         ⍝   max(iei, ecoregion iei)[54]   J←(X∊A)/⍳⍴X                            ⍝   Index wet points[55]   Z[J]←Y[J]⌈W[J]                         ⍝   max(iei, watershed iei)[56]   Z←Q⍴((~B)\MV)+B\Z                      ⍝   expand to full grid[57]   Z WRITE R PATH 'rawiei_i'              ⍝   write raw IEI[58]  L2:→(0≠NEXTBLOCK)/L1                    ⍝Until out of blocks[59]   ⎕←''    ∇