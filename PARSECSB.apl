    ∇ Z←PARSECSB L;I;I;R;X;H;G;Y;T;F;Q;J;K;Q_[1]   ⍝Parse CAPS Scenario Builder .csv file ⍵ and return CSB table & column names[2]   ⍝CSB files (in .csv format), created by Bob English's CAPS Scenario Builder, consist of up to 3 WKT sections,[3]   ⍝one each for points, lines, and polygons.  Each of these sections has its own header, and then a line for[4]   ⍝each feature. See CAPS Scenario Builder Back End.docx for details on the CSB file format.[5]   ⍝Columns of CSB table:[6]   ⍝  1. Id        (from one of the *_id columns)[7]   ⍝  2. Type      crossing, dam, wildlife, tr, newroad, roadchange, landcover[8]   ⍝  3. Feature   1 = point, 2 = line, or 3 = poly[9]   ⍝  4. Altered   1 or 0, for crossings, dams, wildlife passage, and TR[10]  ⍝  5. Deleted   1 or 0, for crossings, dams, wildlife passage, and TR[11]  ⍝  6. Value1    crossings & dams: aquatic crossing score, wildlife passages: terrestrial crossing score,[12]  ⍝               TR: restriction score, modified or new roads: traffic rate, landcover: cover class[13]  ⍝  7. Value2    crossings: terrestrial crossing score, modified or new roads: road class, landcover: mitigation discount)[14]  ⍝  8. Description[15]  ⍝  9. Spatial   matrix of x,y points[16]  ⍝B. Compton, 26-27 Jun 2012[17]  ⍝2 Jul 2014: Harvest mitigation discount for landcover change[18]  ⍝5 Dec 2014: make pre-mitigation discount files upward compatible[19]  [20]  [21]  [22]   R←+\(⊂'WKT')≡¨↓L[;⍳3]                                      ⍝Find WKT headers and mark lines for each WKT group[23]   Q_←'id type feature altered deleted value1 value2 description spatial'[24]   Z←0 9⍴0[25]   I←0[26]  L1:→((⌈/,R)<I←I+1)/L2                                       ⍝For each WKT group,[27]   X←(R=I)⌿L[28]   H←1 0↓',' MATRIFY FRDBL X[1;]                              ⍝   Header (drop WKT)[29]   X←1 0↓X[30]   G←0 1↓LJUST (⍴X)↑T←(+/1=+\X='"')⌽((⍴X)⍴' '),X              ⍝   Pull out geometry[31]   Y←FRDBL¨↑↓¨VTOM¨↓FRDBL (0,1+1↓⍴X)↓T                        ⍝   and rest of data[32]   F←('POINT' 'LINESTRING' 'POLYGON')⍳FRDBL¨↓VTOM FIRSTCOL MTOV G    ⍝   Feature[33]   G←',' MATRIFY ¨¯1↓¨FRDBL¨((↓G)⍳¨'(')↓¨↓G                   ⍝   Geometry, as character matrices[34]   G←(↓(.5×⊃,/⍴¨T),[1.5]2)⍴¨T←⎕FI¨,¨' ',¨G                    ⍝   Geometry, in n×2 numeric matrices[35]  [36]   Q←0,0,F,(⊂''),(⊂''),0,0,(⊂''),[1.5]G                       ⍝   Start putting table together (feature, spatial)[37]  [38]   →(F[1]=⍳3)/L3,L4,L5                                        ⍝   Case points, lines, polygons:[39]   ÷0[40]  L3:J←H MATIOTA MATRIFY 'cross_id dam_id wildlf_id restr_id' ⍝   Points[41]   Q[;Q_ COL 'id']←Y SCATI_A  (⍳1↑⍴Y),[1.5]K←J[1++/^\(⊂'')≡¨Y[;J]][42]   Q[;Q_ COL 'type']←(FRDBL¨↓MATRIFY 'crossing dam wildlife tr')[J⍳K][43]   Q[;Q_ COL 'altered']←Y SCATI_A (⍳1↑⍴Y),[1.5](H MATIOTA MATRIFY 'c_altered d_altered w_altered r_altered')[J⍳K][44]   Q[;Q_ COL 'deleted']←Y SCATI_A (⍳1↑⍴Y),[1.5](H MATIOTA MATRIFY 'c_deleted d_deleted w_deleted r_deleted')[J⍳K][45]   Q[;Q_ COL 'value1']←Y SCATI_A (⍳1↑⍴Y),[1.5](H MATIOTA MATRIFY 'c_aqua_scr d_aqua_scr w_terr_scr r_rest_scr')[J⍳K][46]   Q[T;Q_ COL 'value2']←Y[T←(1=J⍳K)/⍳1↑⍴Y;H MATIOTA 'c_terr_scr'][47]   Q[;Q_ COL 'description']←Y SCATI_A (⍳1↑⍴Y),[1.5](H MATIOTA MATRIFY 'c_describe d_describe w_describe r_describe')[J⍳K][48]   →L6[49]  [50]  L4:Q[;Q_ COL 'id']←Y[;1]                                    ⍝   Lines (only 1 type)[51]   Q[;Q_ COL 'type']←⊂'newroad'[52]   Q[;Q_ COL 'value1 value2 description']←Y[;H MATIOTA MATRIFY 'newrd_rate nrd_class nrd_descr'][53]   →L6[54]  [55]  L5:J←H MATIOTA MATRIFY 'modrd_id ldcvr_id'                  ⍝   Polys[56]   Q[;Q_ COL 'id']←Y SCATI_A  (⍳1↑⍴Y),[1.5]K←J[1++/^\(⊂'')≡¨Y[;J]][57]   Q[;Q_ COL 'type']←(FRDBL¨↓MATRIFY 'roadchange landcover')[J⍳K][58]   Q[;Q_ COL 'value1']←Y SCATI_A (⍳1↑⍴Y),[1.5](H MATIOTA MATRIFY 'modrd_rate ldcvr_cls')[J⍳K][59]   H←H OVER 'ldcvr_miti' ⋄ Y←Y,0                              ⍝   Make legacy projects upward compatable[60]   Q[;Q_ COL 'value2']←Y SCATI_A (⍳1↑⍴Y),[1.5](H MATIOTA MATRIFY 'nrd_class ldcvr_miti')[J⍳K][61]   Q[;Q_ COL 'description']←Y SCATI_A (⍳1↑⍴Y),[1.5](H MATIOTA MATRIFY 'mrd_descr l_describe')[J⍳K][62]   →L6[63]  [64]  L6:Z←Z⍪Q[65]   →L1[66]  [67]  L2:Z←Z Q_    ∇