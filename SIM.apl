    ∇ A SIM S;X;Q;J;I;R;W;Z;K;L;D;T;E;B;M;buffer;D50;DS;Y;V;sd;sdt[1]   ⍝CAPS 2.0 similarity metric[2]   ⍝⍺ = (landcover grid) (settings) (result grid) (buffer)[3]   ⍝Paramters:[4]   ⍝   D50 Inflection point[5]   ⍝   DS  Scaling factor[6]   ⍝B. Compton, 8 Jan 2008 [New Hampshire primary today; looks like Obama will win big][7]   ⍝16 Apr 2008: return contrast, not similarity--we don't know maximum distance [he didn't][8]   ⍝29 Apr 2008: Optional left argument lists grids for timesteps or scenarios; mask grid[9]   ⍝29 Sep 2008: multiple grids allows multiple settings grids, specifies result file or path[10]  ⍝6 Oct 2008: * If settings are empty, use fixed contrasts for all cover types (for fast Losing Ground run)[11]  ⍝16 Jan 2009: Use GETINFO scheme[12]  ⍝5 Oct 2010: use INCLUDE[13]  ⍝15 Nov 2010: modified version of SETTINGS[14]  ⍝30 Jan 2011: oops.  Include anthro groups in settings.[15]  ⍝18 Feb 2011: Always set anthro settings to zero for focal cell[16]  ⍝31 Oct 2011: use ecodistpower and other changes for new SETTINGS (18" of snow Oct 29-30!)[17]  [18]  [19]  [20]   READPARS ME[21]   buffer←B←4⊃A[22]   X←READ 1⊃A[23]   →(0∊⍴Y←S INCLUDE X)/0          ⍝Which cells to run for?[24]   Z←(⍴X)⍴MV[25]   sd sdt ← SETTINGS (2⊃A) 'anthro1 anthro2' 'dist' ⍝Get ecological settings and tables for distance[26]   V←LOOKUP resist                ⍝* Get distances set by cover type, not ecolgical distance[27]   V←(V⍪0)[V[;1]⍳X;2]             ⍝* Cover types not on list get no distance[28]  [29]   E←B≥M←DIST 1+2×B               ⍝Circular window[30]   M←E×1-÷1+*(-(M×cellsize)-D50)÷DS   ⍝Logistic surface (clipped to circular window)[31]   D←(⍳1+2×B)-B+1                 ⍝Maximum radius possible to travel[32]  [33]   I←B[34]  L1:→(((1↑⍴X)-B)<I←I+1)/L3       ⍝For each row,[35]   BREAKCHECK[36]   →(~∨/Y[I;])/L1                 ⍝   Skip empty rows[37]   J←B[38]  L2:→(((1↓⍴X)-B)<J←J+1)/L1       ⍝   For each column,[39]   →(~Y[I;J])/L2                  ⍝      If we're doing this cell,[40]   K←I+D ⋄ L←J+D[41]   R←V[K;L]                       ⍝         * fixed contrast for all cover types[42]   →(0∊⍴sd)/L4                    ⍝         * If we have ecological settings[43]   R←(sdt[;2]×sd[;I;J]) ECODIST sd[;K;L]  ⍝         Get ecological distance for focal cell I,J[44]  L4:R←0 MVREP R (X[K;L]=MV)[45]   T←+/,M×R                       ⍝         Similarity is sum of resistances, scaled by logistic[46]   Z[I;J]←T DIV +/,M×E×X[K;L]≠MV  ⍝         Scale by max possible[47]   →(0∊⍴example)/L2               ⍝         If producing intermediate results,[48]   EXAMPLE MVREP (M×R) (~E^X[K;L]≠MV)[49]   →L2[50]  [51]  L3:(X REMV Z) WRITE 3⊃A[52]   →0[53]  [54]  what:CAPS resiliency[55]  type:standard[56]  info:('land') ('settings') ('sim') (⌈(''⍴SEARCH D50,DS)÷cellsize) 'include'      ⍝Source grid, settings table, result grid, buffer size, and include grid[57]  check:CHECKVAR 'D50 DS'[58]  check:CHECKCOVER 'resist'[59]  check:CHECKFILE pathT PATH scales    ∇