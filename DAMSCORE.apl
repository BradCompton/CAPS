    ∇ A DAMSCORE S;buffer;D;H;Z;Q;B[1]   ⍝Create CAPS dam barrier scores from TNC dam barrier scores and dam height[2]   ⍝Scoring is hardwired here.  See Aquatic Passability Scores for TNC Dams Data FINALer.docx.[3]   ⍝B. Compton, 29 Jan 2009[4]   ⍝5 Jan 2014: use dam height for dams with fish passage (barrier score = 4), because passage data are junk.[5]   ⍝5 Aug 2015: don't require include grid, as it's not used; 15 Sep 2015: but don't use damheight as include, as it can be legimately zero![6]   [7]   [8]   [9]    READPARS ME[10]   buffer←4⊃A[11]  [12]   S←0 ¯1 .6 .3 .9 ¯1 .3      ⍝UMass passability scores for TNC barrier scores ⍳7[13]                              ⍝Note: for barrier scores 2 and 6, we use logistic function of height[14]  [15]   D←MVREP READ 1⊃1⊃A[16]   H←READ 2⊃1⊃A[17]   Z←(S,0)[(⍳7)⍳D]            ⍝Assign passability scores[18]  [19]   Q←(B←,D∊2 4 6)/,H          ⍝Heights for small & unknown dams[20]   Q←0.2×1.5 ¯0.2 LOGISTIC Q  ⍝Scale using CAPS height → UMass passability score[21]   Z←(⍴Z)⍴((~B)\(~B)/,Z)+B\Q  ⍝Insert height-based values[22]   Z←1-Z                      ⍝And convert to CAPS barrier score[23]   (MVREP Z (D=MV)) WRITE 3⊃A ⍝Save results[24]   →0[25]  [26]  [27]  what:data prep[28]  type:standard[29]  info:((⊂pathS),¨'tncdambar' 'damheight') ('') (pathS,'dambar') 0 (pathS,'tncdambar')      ⍝Source grid, settings table, result grid, buffer size, and include grid    ∇