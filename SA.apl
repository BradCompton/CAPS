    ∇ P SA X;S;E;B;K;N;M;P;ftie;R;Z;T[1]   ⍝Simulated annealing of initial state ⍵[2]   ⍝⍵ is starting state, or x y prob[3]   ⍝Parameters ⍺:[4]   ⍝   ⍺[1] kmax - maximum number of iterations[5]   ⍝   ⍺[2] emax - maximum energy of solution[6]   ⍝   ⍺[3] annealing schedule (factor to reduce temperature)[7]   ⍝   ⍺[4] scoring parameter(s)[8]   ⍝   ⍺[5] number of cells to move when picking neighbors - I think this should be 1[9]   ⍝   ⍺[6] restart - number of iterations to allow before restarting[10]  ⍝Based on pseudocode on Wikipedia[11]  ⍝Run:[12]  ⍝   SA 40 100 10[13]  ⍝B. Compton, 31 Aug 2007[14]  [15]  [16]   ⍎(0=⎕NC'P')/'P←⍳0'[17]   P←6↑P,(⍴,P)↓100000 ¯1000 .95 2 1 100[18]   ⍎(2>⍴⍴X)/'X←1=?X[1 2]⍴(×/X[1 2])⍴X[3]'[19]  [20]   T←.01×?(⍴X)⍴100 ⋄ iei←(T+FOCALSUM T)÷1+FOCALSUM (⍴T)⍴1[21]  [22]  ⍝ (⍕iei) NWRITE PATH 'iei.txt'[23]  ⍝ ⎕NUNTIE ⎕NNUMS ⋄ '' NWRITE PATH 'sa.txt' ⋄ (PATH 'sa.txt') ⎕NTIE ftie←-1+0⌈⌈/|⎕XNNUMS  ⍝Temp for display[24]  [25]   B←E←-+/,S←P[4] SA_SCORE Z←X          ⍝Energy of initial state[26]   SA_DISP X E 0[27]   R←K←0[28]  L1:→(~(P[1]>K←K+1)^E>P[2])/L9  ⍝While time remains & not good enough,[29]   →(P[6]≥R-K)/L3                 ⍝   If restart counter is too high,[30]   X←Z ⋄ M←B                      ⍝      We've wandered too far from previous best...restart[31]  L3:N←P[5] S SA_NEIGHBOR X       ⍝   Pick a neighbor  *** P[5] SHOULD START HIGH AND DECREASE WITH TEMPERATURE ***[32]   M←-+/,S←P[4] SA_SCORE N        ⍝   Score it[33]   →(M>B)/L2                      ⍝   Is this the new best state?[34]   Z←X ⋄ B←M                      ⍝      Save it[35]   R←K                            ⍝      Reset the restart counter[36]   SA_DISP Z B K[37]  L2:⍝SA_DISP N M K[38]   →(~((÷1E6 1) UNIFORM 1)<SA_PROB E,M,P[3]*K)/L1   ⍝   Move to new state?[39]   X←N ⋄ E←M                      ⍝      Change state[40]   →L1[41]  L9:⎕←'All done.'[42]   ASDF    ∇