    ∇ FD8FLOW2 I;V;K;Q;J;E[1]   ⍝Recursively calculate FD8 flow accumulation for cell R,C ⍵[2]   ⍝Globals:[3]   ⍝   F   FD8 flow grid (8×R×C)[4]   ⍝   D   1 if this cell is done[5]   ⍝   P   Pending flag: 1 if we're already working on this cell[6]   ⍝   Z   result[7]   ⍝B. Compton, 7-13 Mar 2008 and 27 May 2010 (from FLOW)[8]   [9]   [10]   I J←I[11]   ⍝⎕←'[',(⍕I),',',(⍕J),']' ⋄ FLUSH[12]   →(~P[I;J])/L0[13]   ⍝ ⎕←'FLOW: Infinite loop in flow grid (',(⍕I),',',(⍕J),'). Is this a depressionless DEM?'[14]   bad[I;J]←bad[I;J]+1[15]   →0[16]  L0:P[I;J]←1[17]   V←↑,(I+¯1 0 1)∘.,J+¯1 0 1          ⍝Neighbors[18]   E←D[I+¯1 0 1;J+¯1 0 1]             ⍝Which ones aren't done yet[19]   E[2;2]←1                           ⍝Exclude focal cell[20]   E←(~,E)^F[2 3 4 1 1 5 8 7 6;I;J]≠0 ⍝Only visit cells that flow into this one[21]   V←E⌿V[22]  [23]   K←0[24]  L1:→((1↑⍴V)<K←K+1)/L2               ⍝For each neighbor,[25]   →D[V[K;1];V[K;2]]/L1               ⍝   Bail out if cell has already been done (could happen elsewhere in recursion)[26]   FD8FLOW2 V[K;]                     ⍝   Recurse[27]   →L1[28]  [29]  L2:→D[I;J]/0                        ⍝If this cell was already done during recursion, get out now[30]   Q←F[;I;J]×Z[I;J-1],Z[I-1;J-1],Z[I-1;J],Z[I-1;J+1],Z[I;J+1],Z[I+1;J+1],Z[I+1;J],Z[I+1;J-1][31]  [32]   Z[I;J]←Z[I;J]++/Q[33]   D[I;J]←1                           ⍝Done with this cell    ∇