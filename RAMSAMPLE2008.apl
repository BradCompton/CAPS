    ∇ S RAMSAMPLE2008 W;E;X;Y;U;D;T;M;qt;qtiles;head;K;B[1]   ⍝Process Theresa's sampling plots[2]   ⍝RAMSAMPLE 1 → create random points; ⍺ = number of random points[3]   ⍝&r ramsample[4]   ⍝RAMSAMPLE 2 → process results; ⍺ = separation distance, points per bin[5]   ⍝B. Compton, 29 Feb-3 Mar 2008[6]   ⍝28 Apr 2008: allow more points, print table, give blind points with randomly assigned bins⍝[7]   [8]   [9]   →(1 2=W)/L1,L2[10]  [11]  L1:⍝Create random points for ramsample.aml[12]   ⍎(0=⎕NC'S')/'S←1E6'[13]   E←106950.750 168161.859 865271.438 925460.688[14]   X←E[1]+(UNIFORM S)×(E[2]-E[1])[15]   Y←E[3]+(UNIFORM S)×(E[4]-E[3])[16]   (X,[1.5]Y) MATOUT 'D:\CAPSWEST\RAM\PTS.TXT'[17]   →0[18]  [19]  L2:⍎(0=⎕NC'S')/'S←500 5'            ⍝Separation distance, points per bin[20]   X←MATIN 'D:\CAPSWEST\RAM\sample.txt'[21]   X←0 1↓X                            ⍝X is X, Y, IEI, type, insults, verboten (river buffer)[22]   X←(~(FRDBL¨X[;5])≡¨⊂'MISSING')⌿X[23]   X←(~(FRDBL¨X[;4])≡¨⊂'MISSING')⌿X[24]  [25]   X[;3]←⎕FI ,' ',MIX X[;3][26]   X[;4]←⎕FI ,' ',MIX X[;4][27]   X[;5]←⎕FI ,' ',MIX X[;5][28]   X[;6]←⎕FI ,' ',MIX X[;6][29]   X←(~X[;6])⌿X[;⍳5]                   ⍝Drop out points too close to big rivers[30]  [31]  [32]   X[;4]←X[;4]∊14 16  ⍝1 = FOWET-D or -M[33]   X←(X[;4]∊1)⌿X[34]  [35]   X[;3 5]←X[;3 5]+.001×UNIFORM (1↑⍴X),2   ⍝Add a tiny random number to prevent ties in quantiles[36]   X[;3]←10×10 QUANTILE X[;3]         ⍝Deciles of IEI (0-9)[37]   X[;5]←10×10 QUANTILE X[;5]         ⍝Deciles of insults (0-9)[38]   X←X,(10×X[;3])+X[;5]               ⍝Digits: IEI, insults[39]  [40]   Y←X[41]   K←0[42]  [43]  L3:X←Y,UNIFORM 1↑⍴Y[44]   X←X[⍋X[;6 7];]                     ⍝Sort by class & random number[45]  [46]   U←((X[;6]⍳X[;6])=⍳1↑⍴X)/X[;6][47]   X←X,⊃,/⍳¨+⌿X[;6]∘.=U               ⍝Index[48]   X←(X[;8]≤S[2])⌿X                   ⍝Pick ⍺[2] points in each bin[49]  [50]   D←(((X[;1]∘.-X[;1])*2)+(X[;2]∘.-X[;2])*2)*.5[51]   D←((⍳1↑⍴X)∘.<⍳1↑⍴X)×D<S[1]         ⍝Points within ⍺[1] m of others[52]   X←(~∨⌿D)⌿X                         ⍝Drop subsequent points that are too close[53]  [54]   U←((X[;6]⍳X[;6])=⍳1↑⍴X)/X[;6][55]   X[;8]←⊃,/⍳¨+⌿X[;6]∘.=U             ⍝Re-index[56]   X←(X[;8]≤S[2])⌿X                   ⍝Pick more points[57]  [58]   ⎕←'Number of bins with at least 1, 2, ..., n points: ',⍕T←+⌿X[;8]∘.=⍳S[2][59]  [60]   →((20>K←K+1)^B←T[1]<100)/L3        ⍝Want at least 1 point in each bin...may not be able to get it[61]                                      ⍝This will be either because IEI and insults are highly correlated and[62]                                      ⍝there simply aren't enough points, or because I'm asking for too great[63]                                      ⍝a spacing.[64]  [65]   ⍞←B/'*** Failed to fill all bins in 20 tries.',⎕TCNL[66]  [67]   X←X[;1 2 3 5 6 8][68]   X←X,(100?100)[1+X[;5]]             ⍝Random bin assignments[69]   X←X[⍋X[;7 6];]                     ⍝Sort on bin & index[70]  [71]   head←1↓⎕TCHT MTOV MATRIFY 'x-coord y-coord IEI insults code index bin'[72]   X TMATOUT T←'d:\CAPSWEST\ram\slampoints.txt'[73]   head←1↓⎕TCHT MTOV MATRIFY 'x-coord y-coord index bin'[74]   X[;1 2 6 7] TMATOUT T←'d:\CAPSWEST\ram\blindpoints.txt'[75]  [76]   ⎕←'Points written to ',T[77]   ⎕←''[78]   ⎕←'Number of points per bin:',⎕TCNL[79]   ⎕← '             insults' OVER ⍕(12↑'     IEI'),((2⍴⊂''),¯1+⍳10)⍪'-'⍪(¯1+⍳10),'|',+⌿X[;5]∘.=10 10⍴¯1+⍳100    ∇