    ∇ S RAMSAMPLE W;E;X;Y;U;D;T;M;qt;qtiles;head;K;B;I;H[1]   ⍝Process forested wetland sampling plots for 2012 season[2]   ⍝RAMSAMPLE 1 → create random points; ⍺ = number of random points[3]   ⍝&r ramsample[4]   ⍝RAMSAMPLE 2 → process results; ⍺ = separation distance, points per bin[5]   ⍝B. Compton, 29 Feb-3 Mar 2008[6]   ⍝28 Apr 2008: allow more points, print table, give blind points with randomly assigned bins[7]   ⍝17 Apr 2009: for 2009 season[8]   ⍝2 Mar 2012: for 2012 field season in the Taunton watershed[9]   [10]  THIS IS OLD[11]  [12]  →(1 2=W)/L1,L2[13]  [14]  L1:⍝Create random points for ramsample.aml[15]   ⍎(0=⎕NC'S')/'S←1E6'[16]   I←0[17]  L11:→(1<I←I+1)/0                    ⍝For each watershed[18]   E←(1 4⍴212462.90322 266305.42831  827941.66121  879935.86082)[I;][19]   X←E[1]+(UNIFORM S)×(E[2]-E[1])[20]   Y←E[3]+(UNIFORM S)×(E[4]-E[3])[21]   (X,[1.5]Y) MATOUT 'D:\CAPS\more\taunton\Tauntonpts.txt'[22]   →L11[23]  [24]  L2:⍎(0=⎕NC'S')/'S←500 5'            ⍝Separation distance, points per bin[25]   I←0[26]  L21:→(1<I←I+1)/0                    ⍝For each watershed,[27]   H←'taunton'[28]   ⎕←H,' watershed:'[29]   ⎕←''[30]   X←MATIN 'D:\CAPS\more\',H,'\sample.txt'[31]   X←0 1↓X                            ⍝X is X, Y, IEI, type, insults, verboten (river buffer)[32]   X←(~(FRDBL¨X[;5])≡¨⊂'MISSING')⌿X[33]   X←(~(FRDBL¨X[;4])≡¨⊂'MISSING')⌿X[34]  [35]   X[;3]←⎕FI ,' ',MIX X[;3][36]   X[;4]←⎕FI ,' ',MIX X[;4][37]   X[;5]←⎕FI ,' ',MIX X[;5][38]   X[;6]←⎕FI ,' ',MIX X[;6][39]   X←(~X[;6])⌿X[;⍳5]                   ⍝Drop out points too close to big rivers[40]  [41]  [42]   X[;4]←X[;4]∊14 16  ⍝1 = FOWET-D or -M[43]   X←(X[;4]∊1)⌿X[44]  [45]   X[;3 5]←X[;3 5]+.001×UNIFORM (1↑⍴X),2   ⍝Add a tiny random number to prevent ties in quantiles[46]   X[;3]←10×10 QUANTILE X[;3]         ⍝Deciles of IEI (0-9)[47]   X[;5]←10×10 QUANTILE X[;5]         ⍝Deciles of insults (0-9)[48]   X←X,(10×X[;3])+X[;5]               ⍝Digits: IEI, insults[49]  [50]   Y←X[51]   K←0[52]  [53]  L3:X←Y,UNIFORM 1↑⍴Y[54]   X←X[⍋X[;6 7];]                     ⍝Sort by class & random number[55]  [56]   U←((X[;6]⍳X[;6])=⍳1↑⍴X)/X[;6][57]   X←X,⊃,/⍳¨+⌿X[;6]∘.=U               ⍝Index[58]   X←(X[;8]≤S[2])⌿X                   ⍝Pick ⍺[2] points in each bin[59]  [60]   D←(((X[;1]∘.-X[;1])*2)+(X[;2]∘.-X[;2])*2)*.5[61]   D←((⍳1↑⍴X)∘.<⍳1↑⍴X)×D<S[1]         ⍝Points within ⍺[1] m of others[62]   X←(~∨⌿D)⌿X                         ⍝Drop subsequent points that are too close[63]  [64]   U←((X[;6]⍳X[;6])=⍳1↑⍴X)/X[;6][65]   X[;8]←⊃,/⍳¨+⌿X[;6]∘.=U             ⍝Re-index[66]   X←(X[;8]≤S[2])⌿X                   ⍝Pick more points[67]  [68]   ⎕←'Number of bins with at least 1, 2, ..., n points: ',⍕T←+⌿X[;8]∘.=⍳S[2][69]  [70]   →((20>K←K+1)^B←T[1]<100)/L3        ⍝Want at least 1 point in each bin...may not be able to get it[71]                                      ⍝This will be either because IEI and insults are highly correlated and[72]                                      ⍝there simply aren't enough points, or because I'm asking for too great[73]                                      ⍝a spacing.[74]  [75]   ⍞←B/'*** Failed to fill all bins in 20 tries.',⎕TCNL[76]  [77]   X←X[;1 2 3 5 6 8][78]   X←X,(100?100)[1+X[;5]]             ⍝Random bin assignments[79]   X←X[⍋X[;7 6];]                     ⍝Sort on bin & index[80]  [81]   head←1↓⎕TCHT MTOV MATRIFY 'x-coord y-coord IEI insults code index bin'[82]   X TMATOUT T←'d:\CAPS\more\taunton\',H,'-slampoints.txt'[83]   head←1↓⎕TCHT MTOV MATRIFY 'x-coord y-coord index bin'[84]   X[;1 2 6 7] TMATOUT T←'d:\CAPS\more\taunton\',H,'-blindpoints.txt'[85]  [86]   ⎕←''[87]   ⎕←'Points written to ',T[88]   ⎕←''[89]   ⎕←'Number of points per bin:',⎕TCNL[90]   ⎕← '             insults' OVER ⍕(12↑'     IEI'),((2⍴⊂''),¯1+⍳10)⍪'-'⍪(¯1+⍳10),'|',+⌿X[;5]∘.=10 10⍴¯1+⍳100[91]   ⎕←''[92]   →L21    ∇