    ∇ A MAKECOOKIES S;bandwidth;buffer;X;W;Q;R;Z;Y;slice;culverts;corebandwidth;pathslice;pathbandwidth;corebarriers;pathbarriers;E;dot;C;P;weights;weightshift[1]   ⍝Build buffered terrestrial reserve cores for LCD using resistant kernel[2]   ⍝Input grids:[3]   ⍝   nodes           CL II nodes grid, in pathQ\source\nodes[4]   ⍝   spaths          CL II scaled paths grid for MAKECOOKIES, in pathQ\results\spaths[5]   ⍝   land            landcover grid[6]   ⍝Parameters:[7]   ⍝   bandwidth       bandwidth used to create spaths (km)[8]   ⍝   corebandwidth   bandwidth for cores (m)[9]   ⍝   pathslice       slice of maxpaths for paths to buffer[10]  ⍝   pathbandwidth   width of path buffers (m)[11]  ⍝   corebarriers    Don't allow buffers to cross highways + exclude industrial development[12]  ⍝   pathbarriers    Same thing, for path buffers[13]  ⍝   culverts        These are part of highways when adjacent to highway cells, used to keep[14]  ⍝                   road barriers continuous for both core and path buffers[15]  ⍝   weights         grid with priority areas to decrease threshold as anything but nodata[16]  ⍝   weightshift     number of units to shift threshold in priority areas[17]  ⍝Results:[18]  ⍝   cookies         grid with new reserve network: <node id> = core, 1 = connectors, 2 = node buffers[19]  ⍝B. Compton, 12 Nov 2014[20]  ⍝4 Dec 2014: give cores vs connectors vs buffers in result[21]  ⍝20 Feb 2015: return node id for cores, renumber connectors and buffer[22]  ⍝29 Jan 2016: add priority areas[23]  ⍝6 Mar 2017: flip slash on culvert name. Ugh.[24]  [25]  [26]  [27]   READPARS ME[28]   X←0 MVREP READ 1⊃1⊃A                       ⍝Read nodes grid[29]   Y←0 MVREP READ 2⊃1⊃A                       ⍝and maxpaths grid[30]   W←READ 3⊃1⊃A                               ⍝and landcover[31]  [32]   culverts←'.\./' TEXTREPL culverts          ⍝What a fucking kludge![33]   E←W∊LOOKNAMES corebarriers                 ⍝Set highways to missing so they'll get super-high resistance[34]   E←E∨(W∊LOOKNAMES culverts)^FOCALMAX E      ⍝Set culverts and dams to missing if adjacent to highways[35]   R←1+1E6×E                                  ⍝Resistance is 1 everywhere but barriers[36]  [37]   C←(X≠0)^0=FOCALMIN X                       ⍝Edges of cores[38]   :if corebandwidth=0[39]      Z←(⍴C)⍴0[40]   :else[41]      Z←0≠(⌈corebandwidth÷cellsize) C RKERNELS R ⍝Build kernels for core buffers (assign 1)[42]   :end[43]  [44]   E←W∊LOOKNAMES pathbarriers                 ⍝Set highways to missing so they'll get super-high resistance[45]   E←E∨(W∊LOOKNAMES culverts)^FOCALMAX E      ⍝Set culverts and dams to missing if adjacent to highways[46]   R←1+1E6×E                                  ⍝Resistance is 1 everywhere but barriers[47]  [48]   :if ~weights≡''                            ⍝If priorty areas are being used,[49]      pathslice←pathslice-weightshift×~(READ GRIDNAME weights)∊0,MV[50]   :end[51]   C←Y≥pathslice                              ⍝Paths[52]   Z←Z⌈2×0≠(⌈pathbandwidth÷cellsize) C RKERNELS R ⍝Build kernels for paths (assign 2)[53]   Z←(Z≠0)×3-Z                                ⍝Renumber: <node id> = core, 2 = connectors, 3 = buffers[54]   Z←Z⌈X                                      ⍝Nodes (assign 3)[55]   (MVREP Z (Z=0)) WRITEI 3⊃A                 ⍝Save with all 0's set to missing[56]   ⎕←''[57]   →0[58]  [59]  [60]  [61]  what:auxiliary[62]  type:standard[63]  info:((pathQ,'\source\nodes') (pathQ,'\results\spaths') 'land') ('') (pathQ,'\results\cookies') (⌈(corebandwidth⌈pathbandwidth)÷cellsize)       ⍝Source grid, settings table, result grid, and buffer size[64]  check:CHECKVAR 'bandwidth corebandwidth pathslice pathbandwidth corebarriers pathbarriers culverts weights weightshift'    ∇