    ∇ CLASS_AREAS;loop;test;noread;grids;ffile;tilemapinclude;skiptilemap;E;tilesize;N;X;G;head;Z;Q;Y;T;B;geoclass;usegroups[1]   ⍝Count area in each formation and area in each geophysical setting (only for undeveloped land)[2]   ⍝Source:[3]   ⍝   postland[4]   ⍝   geophysical settings[5]   ⍝   mapcolors.par (see GROUPSUMMARY for details)[6]   ⍝Results (all in z:\LCC\GIS\Final\LCDassess\impact\):[7]   ⍝   ecological_system_areas.txt[8]   ⍝   formation_areas.txt[9]   ⍝   formation_areas.txt[10]  ⍝Note: geophysical settings are missing for many subtidal and tidal rivers[11]  ⍝B. Compton, 6 Feb 2018 (while watching Space-X Falcon Heavy 1st launch)[12]  [13]  [14]  [15]   INIT[16]  [17]   loop←test←noread←0 ⋄ grids←0 0⍴''                  ⍝Silly junk for BLOCK, etc.[18]   ffile←'CLASS_AREAS '[19]   tilemapinclude←0[20]   skiptilemap←0                                      ⍝Don't let DEBUG sabotage this[21]   [22]   tilesize←2000[23]  [24]  [25]   BLOCK (2⍴tilesize),0[26]   SETTILE[27]   E←TILEMAP '' tilesize 0 0                          ⍝Get tilemap, building it if necessary. This will only help if there's mask grid.[28]  [29]   [30]   geoclass←TABLE pathI,'geophysical settings.txt'    ⍝Read geophysical settings class names[31]   Z←Y←0 2⍴0[32]   [33]   N←0[34]  L2:→(~E[N←N+1])/L3                                  ⍝Repeat: read tile, skip if not in tilemap    --- For each tile ---[35]   BREAKCHECK [36]   DOT   [37]   X←READ GRIDNAME 'postland'                         ⍝   Read landcover[38]   G←READ GRIDNAME 'geo'[39]   Q←,~X∊⊃,/MV,LOOK¨↓'/' MATRIFY  'developed/agriculture/great lakes/ocean'   ⍝   drop missing, developed, agriculture, and oceans    [40]   X←Q/,X[41]   G←(Q^,G≠MV)/,G[42]   Z←Z⍪T,[1.5]+⌿X∘.=T←UNIQUE X                        ⍝   summarize landcover[43]   Y←Y⍪T,[1.5]+⌿G∘.=T←UNIQUE G                        ⍝   and geophysical settings[44]  L3:→(0≠NEXTBLOCK)/L2                                ⍝Until no more tiles[45]  [46]   ⎕←''[47]   Z←Z[⍋Z;]                                           ⍝Do ecological systems[48]   B←Z[;1]≠0,¯1↓Z[;1][49]   Z←(B/Z[;1]),[1.5]B pSUM Z[;2][50]   Z[;2]←Z[;2]×1E¯4×cellsize*2                        ⍝convert areas to ha[51]  [52]   Q←(landcover[landcover[;1]⍳Z[;1];2]),Z[;,2]        ⍝by ecological system[53]   head←1↓⎕TCHT MTOV '/' MATRIFY 'ecological system/area (ha)'[54]   Q TMATOUT T←'z:\LCC\GIS\Final\LCDassess\impact\ecological_system_areas.txt'[55]   ⎕←'Ecological system areas written to ',T[56]   [57]   usegroups←'mapcolors.par'                          ⍝Do formations[58]   Z←0 ¯1↓GROUPSUMMARY Z,0[59]   head←1↓⎕TCHT MTOV '/' MATRIFY 'formation/area (ha)'[60]   Z TMATOUT T←'z:\LCC\GIS\Final\LCDassess\impact\formation_areas.txt'[61]   ⎕←'Formation areas written to ',T[62]  [63]   Y←Y[⍋Y;]                                           ⍝Do geophysical settings[64]   B←Y[;1]≠0,¯1↓Y[;1][65]   Y←(B/Y[;1]),[1.5]B pSUM Y[;2][66]   Y[;1]←geoclass[geoclass[;1]⍳Y[;1];2]               ⍝get geophysical settings names[67]   Y[;2]←Y[;2]×1E¯4×cellsize*2                        ⍝convert areas to ha[68]   head←1↓⎕TCHT MTOV '/' MATRIFY 'geophysical setting/area (ha)'[69]   Y TMATOUT T←'z:\LCC\GIS\Final\LCDassess\impact\geophysical_settings_areas.txt'[70]   ⎕←'Geophysical settings areas written to ',T[71]   ⎕←'Warning: geophysical settings are missing for many subtidal and tidal cells'    ∇