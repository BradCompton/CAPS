    ∇ Z←F RSHED D;R;S;C;Q;Y;B;J[1]   ⍝Build resistant watershed and impounded grid for cell ⍵ in flow and resistance grids ⍺[2]   ⍝Global:[3]   ⍝   spread = spread value in cells[4]   ⍝Returns resistant watershed[5]   ⍝B. Compton, 2 Aug 2012, from RSHED_DAM (original version, now superceded by QSHED)[6]   [7]   [8]   [9]    F R ← F[10]   Z←(⍴R)⍴0[11]   Z[D[1];D[2]]←spread                            ⍝Focal cell gets spread value[12]   C←1 2⍴D                                        ⍝Start list with focal cell[13]  L1:→(0∊⍴C)/L9                                   ⍝   If any cells left in list,[14]   Q←F FLOWINTO D←C[1;]                           ⍝      take focal cell and add inflowing cells to list[15]   Y←0⌈Z[D[1];D[2]]-R SCATI Q                     ⍝      Subtract resistance from spread[16]   J←0[17]  L2:→((1↑⍴Q)<J←J+1)/L3                           ⍝      Loop here for speed--SCATR is slow with large matrices[18]   Z[Q[J;1];Q[J;2]]←Y[J][19]   →L2[20]  L3:⍝Z←Z SCATR Q Y                                  ⍝      and save influence values[21]   C←(1 0↓C)⍪(Y>0)⌿Q                              ⍝      Keep cells that haven't reached zero[22]   →L1[23]  [24]  L9:Z←Z÷spread                                   ⍝Scale influence from 0~1    ∇