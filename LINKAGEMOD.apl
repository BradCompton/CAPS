    ∇ Z←V LINKAGEMOD X;I;Q;M;L;Y;R;value;score[1]   ⍝Modify values of resistance settings grids ⍵ for focal cell (crossing, dam, or road cell) from LINKAGES[2]   ⍝   1⊃⍺     settings table (settings variable, function to modify each settings variable, optional score)[3]   ⍝   2⊃⍺     x,y of focal cell(s) (might be more than one because of grouped culverts)[4]   ⍝   3⊃⍺     settings variable names[5]   ⍝   4⊃⍺     scales for settings variables, created by GETRANGES (scalesettings.txt)[6]   ⍝   5⊃⍺     weight vector from SETTINGS[7]   ⍝Functions modify settings variable in original scale using functions like *0.1		[8]   ⍝or -0.5, or replacement functions like 0 (doesn't use 'score' like CROSSINGSMOD does except for crossings uncertainty).[9]   ⍝Values are kept between 0 and 1[10]  ⍝B. Compton, 25 Jul 2011, from CROSSINGSMOD[11]  ⍝8-11 Aug 2011: Replace neighbors to get wide dams & culverts and wide roads/railroads (but only a little wide!); pass scores in 3rd element of 1⊃V[12]  ⍝15 Aug 2011: replace neighbors only if requested; rescale given settings weights[13]  ⍝18 Aug 2011: Add value[14]  ⍝6 Sep 2011: score has no business being in LINKAGEMOD!   13 Oct 2011: yes it does!  It's used only for crossings uncertainty.[15]  ⍝22 Sep 2011: now that aqconnect follows flow lines, don't widen dams and culverts any more[16]  ⍝13 Oct 2011: bring score back in; it's needed for crossings uncertainty[17]  [18]  [19]  [20]   Z←X[21]   →((1 1⍴MV)≡1⊃V)/0                              ⍝Bail out if no scores[22]   V←5↑V,0[23]   M←(1⊃V)[;⍳2],(4⊃V)[(TOLOWER¨(4⊃V)[;1])⍳FRDBL¨TOLOWER (1⊃V)[;1];2 3]     ⍝Settings variable, function, original scale (min, max)[24]   L←(3⊃V)⍳FRDBL¨M[;1]                            ⍝Indices into target settings variables[25]   M←M,(5⊃V)[L]                                   ⍝Rescaling from SETTINGS[26]   M←M,((1↑⍴M),1)↑0 2↓(1⊃V),0                     ⍝and score (optional)[27]   Y←(¯2↑1 1,⍴Y)⍴Y←2⊃V                            ⍝Focal cell(s)[28]  [29]   I←0[30]  L1:→((⍴L)<I←I+1)/0                              ⍝For each target settings variable,[31]   X←Z[L[I];;]                                    ⍝   Settings variable[32]   Q←M[I;3]+((X SCATI Y)÷M[I;5])×-/M[I;4 3]       ⍝   Settings variable at crossings in original scale[33]   value←Q[34]   score←⊃M[I;6][35]   R←((LJUST⍕⊃M[I;2])[1]∊'+-×*÷/')/'Q'            ⍝   If function starts with +-*/, it's modifying settings variable; otherwise it replaces it[36]   ⍎'Q←',R,REPLACESYM ⍕⊃M[I;2]                    ⍝   Apply function[37]   Q←M[I;5]×(Q-M[I;3])÷-/M[I;4 3]                 ⍝   back to original scale[38]   X←X SCATR Y (0⌈1⌊Q)                            ⍝   replace into grid; don't allow anything out of 0~1 range[39]   Z[L[I];;]←X[40]   →L1    ∇