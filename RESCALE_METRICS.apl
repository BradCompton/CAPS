    ∇ Z←RESCALE_METRICS P;C;Y;X;B;I;Q;M;K;J;A;V;T;R;O[1]   ⍝Rescale metrics by communtiy given benchmarks.  Subroutine of POSTSCALE.[2]   ⍝⍵ = land cover, metric, communities, benchmark matrix, 1 if reverse, 1 if zero-pushing[3]   ⍝B. Compton, 7 Oct 08[4]   ⍝19 May 2009: unexpected nodata cells ← 0 and a warning[5]   ⍝7 Feb 2011: work with 0 quantile from QTILEZ (1st element of V is 0)[6]   ⍝25 Mar 2011: name change from RESCALE[7]   ⍝26 Mar 2012: deal with extra count column in benchmark file[8]   ⍝20 May 2014: don't bother to loop over communities with no points[9]   ⍝25 Sep 2014: if zero-pushing and not reversing, add 0.01.  I don't fully understand this, but connect & aqconnect ran from 0-0.99 and all else was correct.[10]  [11]  [12]  [13]   X Y C B R O ← P[14]   V←((O/0),⍳T)÷T←¯3+1↓⍴B     ⍝n-tiles (note: values range from .01 to 1.0 for percentiles, including 0 if zero-pushing)[15]   Y←8 ROUND Y                ⍝Avoid rounding errors[16]   Z←(×/⍴Y)⍴MV[17]   I←0[18]  L1:→((⍴C)<I←I+1)/L5         ⍝For each target community,[19]   Q←(M←,X=C[I])/,Y           ⍝   points in this community[20]   missing←missing⍪(C[I]∊B[;1])⌿1 3⍴(1↑(B[;1]=C[I])/B[;2]),C[I],+/Q=MV[21]   →(0∊⍴Q)/L1                 ⍝   skip if no points[22]   K←3↓,(B[;1]=C[I])⌿B        ⍝   cutpoints[23]  [24]   A←J←0[25]  L2:→((⍴K)<J←J+1)/L3         ⍝   For each n-tile,[26]   A←A+Q≥K[J][27]   →L2[28]  [29]  L3:A←V[1⌈A][30]   :if R                      ⍝   If reversing metric,[31]      A←V[1]+1-A              ⍝      reverse it (done for stressor metrics and similarity)[32]   :elseif O                  ⍝   Else, if zero-pushing,[33]      A←V[2]+A                ⍝      add 2nd element to make values run from .01-1.0[34]   :end[35]  [36]   Z[M/⍳⍴Z]←(R^Q=MV)+A×Q≠MV   ⍝   Missing goes to 0 for integrity metrics, and to 1 for stressor metrics[37]   →L1[38]  [39]  L5:Z←(⍴Y)⍴Z    ∇