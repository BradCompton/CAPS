    ∇ MERGEPARS;metrics;X;Z;I;S;T;U;B;E;N;Q;pars;head[1]   ⍝Read all .par files for metrics, and merge them into a single table with all cover types[2]   ⍝Inverse of SPLITPARS[3]   ⍝B. Compton, 23 Mar 2009 (Henri the ornery rooster is gone)[4]   ⍝23 Sep 2010: drop systems column in landcover; ignore metrics not in parameters.par[5]   [6]   [7]    SETPATHS[8]    metrics←1 TABLE 'metrics'[9]    metrics←(~⊃,/0∊¨⍴¨metrics[;1])⌿metrics[10]   pars←NREAD pathI PATH 'parameters.par'[11]  [12]   Z←((1↑⍴Z),1+1↑⍴metrics)↑Z←0 1↓TABLE landcoverpar[13]   N←(1↑⍴metrics)⍴⊂''[14]   Q←(1↑⍴metrics)⍴0[15]   E←0 0⍴''[16]   →(~IFEXISTS T←pathI PATH synonymspar)/L0                       ⍝If synonyms file provided,[17]   S←1 0 TABLE T                                                  ⍝   read it[18]   S[;1]←S[⌈\T\(T←~S[;1]≡¨⊂'')/⍳1↑⍴S;1]                           ⍝   fill in first column[19]   S←(0≠⊃,/⍴¨S[;2])⌿S[20]  L0:I←0[21]  L1:→((1↑⍴metrics)<I←I+1)/L2                                     ⍝For each metric,[22]   →L1 IFERRIN 'N[I]←⊂FINDTABLE ⊃metrics[I;1]'                    ⍝   find table[23]   →(0∊⍴⊃N[I])/L1[24]   Q[I]←1[25]   X←TABLE ⊃N[I]                                                  ⍝   and read it[26]   U←(¯1,X[;1])[1+T←(TOUPPER MIX X[;2]) MATIOTA TOUPPER MIX S[;1]],S[;,2]      ⍝   find matches[27]   X←X⍪(U[;1]≠¯1)⌿U                                               ⍝   add to X[28]   X←(~(⍳1↑⍴X)∊T)⌿X                                               ⍝   and drop group names[29]   B←(TOUPPER¨Z[;1])⍳TOUPPER¨X[;2][30]   E←E OVER (∨/B>1↑⍴Z)⌿('[',(⊃metrics[I;1]),']') OVER ' ',' ',' ',MIX (B>1↑⍴Z)/X[;2][31]   Z[(B≤1↑⍴Z)/B;I+1]←(B≤1↑⍴Z)/X[;1][32]   →L1[33]  [34]  L2:head←1↓⎕TCHT MTOV 'cover type' OVER MIX STRIP¨Q/N[35]   ((1,Q)/Z) TMATOUT T←pathM PATH 'merged.par'[36]   ⎕←'Merged parameter file written to ',T[37]   →(0∊⍴E)/0[38]   ⎕←''[39]   ⎕←'*** Errors in cover types named in metric tables:'[40]   ⎕←E    ∇