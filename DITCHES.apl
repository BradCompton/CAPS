    ∇ A DITCHES S;H;D;Z;I;T;search;self;bandwidth;buffer;B;J;D;K;L;Y;self;X;Q;factor[1]   ⍝CAPS salt marsh ditching metric[2]   ⍝Don't need to bother with systems because there are only ditches for salt marshes[3]   ⍝This metric takes a ratio of ditches to salt marshes[4]   ⍝12 Jan 2010.  13-15 Jan: account for marsh size.  13 Dec 2010: okay for CAPS 3.0[5]   ⍝24 Jun 2011: Fix ÷0[6]   ⍝4 Nov 2015: add factor option--use factor = 900 when 30 m cells of ditches are count of 0-900 1 m cells (only affects scaling of result)[7]   ⍝18 Jan 2017: return nodata outside of salt marshes[8]   [9]   [10]  [11]   READPARS ME[12]   buffer←B←4⊃A[13]   Z←0×X←READ 1⊃1⊃A                       ⍝Get landcover[14]   :if 0∊⍴Y←S INCLUDE X                   ⍝Which cells to run for? If none, return missing[15]      Y←(⍴X)⍴MV[16]      →L3[17]   :end[18]   D←0 MVREP READ pathG PATH 2⊃1⊃A        ⍝Read ditches[19]   Z←(⍴D)⍴0                               ⍝Make sure we're writing zeros where no ditches (there may still be marshes!)[20]   Z←bandwidth KERN D                     ⍝   Build ditch kernels[21]   Z←(-T)↓(T←.5×(⍴Z)-⍴D)↓Z[22]   Q←bandwidth KERN factor×Y←(0 MVREP X)∊(LOOKUP ditches)[;1]⍝   Build salt marsh kernels[23]   Q←(-T)↓(T←.5×(⍴Q)-⍴D)↓Q[24]  ⍝ Q WRITE pathR PATH 'M'                ⍝ *** for testing.  Test with BLOCK 5,76 (block size = 100)[25]  ⍝ Z WRITE pathR PATH 'D'[26]   Z←(Z×Y) DIV Q                          ⍝Ratio of ditches:marshes; return results only for salt marshes[27]  L3:Z←MVREP Z (~Y)                         ⍝Return nodata outside of salt marshes[28]   (X REMV Z) WRITE pathR PATH 3⊃A[29]   →0[30]  [31]  what:CAPS coastal[32]  type:standard[33]  info:('land' 'ditches') ('') ('ditches') (⌈bandwidth×search÷cellsize) 'include'      ⍝Source grid, settings table, result grid, buffer size, and include grid[34]  check:CHECKVAR 'bandwidth search ditches factor'[35]  check:CHECKCOVER 'ditches'    ∇