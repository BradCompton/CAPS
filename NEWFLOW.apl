    ∇ Z←O NEWFLOW X;Y;V;M;F;D;L;I;G;P;A[1]   ⍝Calculate flow accumulation for DEM, D8 flow direction, and D8 flow accumulation ⍵ using FD8 (multiple flow path) algorithm, starting at outflow ⍺[2]   ⍝Parameters:[3]   ⍝   Depressionless DEM (use FILL in Arc/Grid) ← If not depressionless, all bets are off![4]   ⍝   D8 flow direction grid (from FLOWDIRECTION in Arc/Grid)[5]   ⍝Reference: Wilson and Gallant (2000)[6]   ⍝Possible extension: use D8 (or mix with FD8 with accumulation gets higher (i.e., in stream channels)[7]   ⍝B. Compton, 24 Sep-28 Oct 2009 (from FLOWACCUM in TOPO, 7-13 Mar 2008)[8]   [9]   [10]   X Y A ← X[11]   V←1.1                   ⍝Flow concentration constant[12]   X←(1+⌈/,X) MVREP X      ⍝Nodata DEM cells are higher than landscape--edges flow inwards[13]   G←(2*0,⍳7)∘.=Y          ⍝D8 flow directions (from Arc flow grid)[14]  [15]  ⍝Step one: calculate flow directions using FD8[16]  ⍝This is split up to keep from filling memory; it can be done in tiles[17]   F←X-1⌽X                 ⍝Flow from focal to east[18]   F←F,[.5]X-1⌽1⊖X         ⍝   southeast[19]   F←F⍪X-1⊖X               ⍝   south[20]   F←F⍪X-¯1⌽1⊖X            ⍝   southwest[21]   F←F⍪X-¯1⌽X              ⍝   west[22]   F←F⍪X-¯1⌽¯1⊖X           ⍝   northwest[23]   F←F⍪X-¯1⊖X              ⍝   north[24]   F←F⍪X-1⌽¯1⊖X            ⍝   northeast[25]   L←∨⌿F=0                 ⍝   Mark flat cells--we'll use D8 for them[26]   L←L∨0⍪0,((A≥d8threshold),0)⍪0    ⍝   Mark streams with large watersheds--we'll use D8 for these too[27]   L[1,1↑⍴L;]←L[;1,1↓⍴L]←0 ⍝   but not borders[28]  [29]  LL←L[30]  [31]   F[;1,1↑⍴X;]←F[;;1,1↓⍴X]←0⍝   and clear borders in flow[32]   F←F÷⍉(⌽⍴F)⍴1 2*.5       ⍝   Slope is less steep at corners, because it's farther![33]   F←((0⌈F)÷cellsize)*V[34]   F←F DIV(⍴F)⍴+⌿F[35]  [36]  ⍝Step two: replace cells in perfectly flat areas and higher-order streams with D8 flows[37]   F←,F[38]   F[I]←(,G)[I←((8××/⍴X)⍴L)/⍳×/⍴F][39]   F←(8,⍴X)⍴F[40]  [41]  ⍝Step three: rotate flow grids to represent flow into each focal cell[42]   F[1;;]←¯1⌽F[1;;]       ⍝Flow from west to focal[43]   F[2;;]←¯1⊖¯1⌽F[2;;]    ⍝   northwest[44]   F[3;;]←¯1⊖F[3;;]       ⍝   north[45]   F[4;;]←¯1⊖1⌽F[4;;]     ⍝   northeast[46]   F[5;;]←1⌽F[5;;]        ⍝   east[47]   F[6;;]←1⊖1⌽F[6;;]      ⍝   southeast[48]   F[7;;]←1⊖F[7;;]        ⍝   south[49]   F[8;;]←1⊖¯1⌽F[8;;]     ⍝   southwest[50]  [51]  ⍝Step four: calculate flow accumulation[52]   Z←(⍴X)⍴1                ⍝Result (with borders)[53]   D←1,(1⍪((¯2+⍴X)⍴0)⍪1),1 ⍝Done flag (borders are already done)[54]  D←D×0  ⍝DONT MARK BORDERS?[55]   P←(⍴X)⍴0                ⍝Pending flag to catch infinite loops due to D8 flow errors[56]  L1:FLOW O+1              ⍝Call recursive flow accumulation function[57]  Z←MVREP Z (~D)           ⍝UNVISITED CELLS → NODATA[58]  ⍝ →(0∊D)/L1[59]   Z←1 1↓¯1 ¯1↓Z    ∇