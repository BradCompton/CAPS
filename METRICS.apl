    ∇ S METRICS M;X;I;Q;J;Y;T;NONE;P;C[1]   ⍝Set CAPS to run metric(s) ⍵ with default block size for new metrics 1⊃⍺ and metric path 2⊃⍺ (suppress chatter if 3⊃⍺)[2]   ⍝If ⍵='', give current list of metrics to run[3]   ⍝If ⍵='none', don't run any[4]   ⍝Writes backup if there isn't one yet, otherwise leave it[5]   ⍝Intended for quick single metric runs, e.g. for settings variables[6]   ⍝B. Compton, 1 and 10 Sep 2010[7]   ⍝2 Jul 2012: allow setting alternative path & suppressing chatter[8]   [9]   [10]   SETPATHS[11]   ⍎(0=⎕NC'S')/'S←1000 pathI 0'[12]   S P C ← 3↑S,⊂pathI[13]   X←NREAD P PATH 'metrics.par'[14]   →(~0∊⍴M)/L1                                ⍝If null parameter,[15]   Q←VTOM ⎕TCNL,⎕TCHT FIRSTCOL X[16]   Y←VTOM ⎕TCNL,⎕TCHT FIRSTCOL REST[17]   Y←(0≠(MATRIFY 'yes Yes YES') MATIOTA Y)⌿Q[18]   →C/0[19]   ⎕←'Metrics currently set to run:'[20]   ⎕←' ',' ',' ',(⎕PW-3) TELPRINT Y[21]   →0[22]  [23]  L1:T←⎕DEF '∇NONE∇'[24]   →(^/T←3=⎕NC TOUPPER M←MATRIFY M)/L2              ⍝If any non-existent metrics,[25]   ⎕←'*** Error: Non-existent metric',((1≠+/T=0)/'s'),':',' ' MTOV (T=0)⌿M[26]   →0[27]  L2:→(IFEXISTS P PATH 'metrics.bak')/L3  ⍝If no backup yet,[28]   ⍞←(~C)/'Backup written to '[29]   X NWRITE T←P PATH 'metrics.bak'[30]   ⍞←(~C)/T,⎕TCNL[31]  L3:X←((('.|.',⎕TCHT) TEXTREPL '.|yes|.|no|.|Yes|.|no|.|YES|.|no|')) TEXTREPL X      ⍝Turn off all metrics[32]   I←(TOUPPER VTOM ⎕TCHT FIRSTCOL X) MATIOTA TOUPPER M←(0='NONE' MATIOTA M)⌿M         ⍝Find metric(s)[33]   →(^/I=0)/L4                                ⍝If any metrics already in file,[34]   X←VTOM ⎕TCNL,X[35]   Q←VTOM ((('.|.',⎕TCHT) TEXTREPL '.|no|.|yes|.|No|.|yes|.|NO|.|yes|')) TEXTREPL MTOV X[J←(I≠0)/I;]  ⍝Turn on metrics[36]   X←((1↑⍴X),(⍴X)[2]⌈(⍴Q)[2])↑X[37]   X[J;]←((1↑⍴Q),(⍴X)[2])↑Q[38]   X←1↓MTOV X[39]  L4:→(^/I≠0)/L5                              ⍝If any metrics need to be added,[40]   Q←↓(I=0)⌿M[41]   X←X,⊃,/⎕TCNL,¨(FRDBL¨TOLOWER¨Q),¨⎕TCHT,¨(⊂'yes'),¨⎕TCHT,¨'*',¨⎕TCHT,¨⊂⍕S   ⍝   Add them[42]  L5:[43]   X NWRITE T←P PATH 'metrics.par'[44]   →C/0[45]   ⍞←'Metrics file written to '[46]   ⎕←T[47]   ⎕←'Ready to run metric',((1≠1↑⍴M)/'s'),':',TOLOWER ' ' MTOV M    ∇