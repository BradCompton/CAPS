    ∇ Z←H RKERN X;I;J;K;L;B;Q;E;R;B;D;M[1]   ⍝Do resistant standard kernel estimator for matrix 1⊃⍵, resistance values 2⊃⍵, and h = ⍺[2]   ⍝Each kernel's volume is standardized to 1, and multiplied by ⍵[3]   ⍝⍺ and cellsize are in meters[4]   ⍝Global search sets search distance in standard deviations[5]   ⍝B. Compton, 2-3 Mar 2011, from KERN and CONNECT[6]   [7]   [8]    X R ← X[9]   [10]   B←⌈H×search÷cellsize                                       ⍝Search distance[11]   X←(-(2×B)+⍴X)↑(B+⍴X)↑X                                     ⍝Expand X to include edges around points[12]   R←1⌈(-(2×B)+⍴R)↑(B+⍴R)↑R[13]   M←MVREP ((⍴X)⍴1) (X=MV)[14]  [15]   E←SPREAD B (B+1) (B+1) ((2⍴1+2×B)⍴1)                       ⍝Maximum possible kernel[16]   E←(E≠0)×ZDENSITY search-E÷H÷cellsize[17]   D←(⍳1+2×B)-B+1                                             ⍝Maximum radius possible to travel[18]  [19]   Z←(⍴X)⍴0[20]  [21]  L1:I←B[22]  L2:→(((1↑⍴X)-B)<I←I+1)/0                                    ⍝For each row,[23]   BREAKCHECK[24]   →(^/0=X[I;])/L2                                            ⍝   If empty row, skip it[25]   J←B[26]  L3:→(((1↓⍴X)-B)<J←J+1)/L2                                   ⍝   For each column,[27]   →(0=X[I;J])/L3                                             ⍝      If we're doing this cell,[28]   K←I+D ⋄ L←J+D[29]   Q←SPREAD B (K⍳I) (L⍳J) (R[K;L])[30]   Z[K;L]←Z[K;L]+X[I;J]×(bandwidth÷cellsize) search CONNECT_RESCALE Q E (M[K;L])[31]   →L3    ∇