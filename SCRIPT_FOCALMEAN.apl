    ∇ R SCRIPT_FOCALMEAN G;X;M;block;loop;grids;noread;E;N;tilemapinclude;dot;skiptilemap;ffile;Z;Q;mask;buffer;altmask;transparent[1]   ⍝Circular focal mean of grid 1⊃⍵, radius 2⊃⍵; part of the LCD scripting system[2]   ⍝Arguments:[3]   ⍝   ⍺[1]            name of result grid[4]   ⍝   ⍺[2]            tilesize[5]   ⍝   ⍵[1]            name of input grid[6]   ⍝   ⍵[2]            radius in cells[7]   ⍝   ⍵[3]            name of mask grid[8]   ⍝Launched by SCRIPT_LAUNCH[9]   ⍝B. Compton, 29 Sep 2014 (from SCRIPT_ADD)[10]  [11]  [12]  [13]   G[2] SCRIPTSETUP 'FOCALMEAN'                   ⍝Set up and set several local variables, buffer is radius[14]  L1:→(~E[N←N+1])/L4                              ⍝Repeat: read tile (skip if not in tilemap)    --- For each tile ---[15]   BREAKCHECK ⋄ DOT[16]   Q←READ 1⊃X                                     ⍝   Read source grid[17]   M←1[18]   :if ~0∊⍴mask                                   ⍝   If mask grid supplied,[19]      M←~(READ mask)∊0,MV                         ⍝      read mask & apply it[20]   :end[21]   M←M^Q≠MV                                       ⍝   mask out all missing in input as well as mask[22]   Z←G[2] FOCALMEANC Q M                          ⍝   Get focal mean[23]   Z WRITE 1⊃R                                    ⍝   write result[24]  L4:→(0≠NEXTBLOCK)/L1                            ⍝Until no more tiles[25]   ⎕←''    ∇