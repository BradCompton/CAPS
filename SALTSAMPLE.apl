    ∇ SALTSAMPLE;E;X;Y;U;D;T;M;qt;qtiles;head;K;B;I;H;S[1]   ⍝Process CZM sampling plots for 2010 season[2]   ⍝1. Arc: &r saltsample[3]   ⍝2. R:   saltsample()[4]   ⍝3. APL: SALTSAMPLE[5]   ⍝12 Apr 2009: for 2009 season, from RAMSAMPLE[6]   ⍝29 Apr 2010: for 2010 season[7]   ⍝13 Apr 2011: for 2011 season[8]   ⍝1 Feb 2012: for 2012 season; use CAPS 2011 run[9]   ⍝26 Jul-9 Aug 2013: *** Restrict to bottom 30% and top 30%[10]  [11]  [12]  [13]   S←500 10 30       ⍝Separation distance, number of within points per bin, number of border points per bin[14]  [15]   X←MATIN 'D:\CAPS\MORE\saltpoints\withinpc.txt'[16]   X←(.1>UNIFORM 1↑⍴X)⌿X              ⍝Sample it down to 10%[17]   X←X[;2 3,¯1 0+1↓⍴X]                ⍝X, Y, pc1, pc2[18]   X[;3 4]←X[;3 4]+.001×UNIFORM (1↑⍴X),2   ⍝Add a tiny random number to prevent ties in quantiles[19]   X[;3]←10×10 QUANTILE X[;3]         ⍝Deciles of pc1 (0-9)[20]   X[;4]←10×10 QUANTILE X[;4]         ⍝Deciles of pc2 (0-9)[21]   X←X,(10×X[;3])+X[;4]               ⍝Digits: pc1, pc2 (5th col)[22]  [23]  [24]   Y←X[25]   K←0[26]  [27]  L1:X←Y,UNIFORM 1↑⍴Y                 ⍝Random number (6th col)[28]   X←X[⍋X[;5 6];]                     ⍝Sort by class & random number[29]  [30]   U←((X[;5]⍳X[;5])=⍳1↑⍴X)/X[;5][31]   X←X,⊃,/⍳¨+⌿X[;5]∘.=U               ⍝Index (7th col)[32]   X←(X[;7]≤S[2])⌿X                   ⍝Pick ⍺[2] points in each bin[33]  [34]   D←(((X[;1]∘.-X[;1])*2)+(X[;2]∘.-X[;2])*2)*.5[35]   D←((⍳1↑⍴X)∘.<⍳1↑⍴X)×D<S[1]         ⍝Points within ⍺[1] m of others[36]   X←(~∨⌿D)⌿X                         ⍝Drop subsequent points that are too close[37]  [38]   U←((X[;5]⍳X[;5])=⍳1↑⍴X)/X[;5][39]   X[;7]←⊃,/⍳¨+⌿X[;5]∘.=U             ⍝Re-index[40]   X←(X[;7]≤S[2])⌿X                   ⍝Pick more points[41]  [42]   ⎕←'Number of bins with at least 1, 2, ..., n points: ',⍕T←+⌿X[;7]∘.=⍳S[2][43]  [44]   →((20>K←K+1)^B←T[1]<100)/L1        ⍝Want at least 1 point in each bin...may not be able to get it[45]                                      ⍝This will be either because IEI and insults are highly correlated and[46]                                      ⍝there simply aren't enough points, or because I'm asking for too great[47]                                      ⍝a spacing.[48]  [49]   ⍞←B/'*** Failed to fill all bins in 20 tries.',⎕TCNL[50]  [51]   X←X[;1 2 3 4 5 7][52]   X←X,(100?100)[1+X[;5]]             ⍝Random bin assignments[53]   X←X[⍋X[;7 6];]                     ⍝Sort on bin & index[54]   X←((^/X[;3 4]∊0 1 2)∨^/X[;3 4]∊7 8 9)⌿X⍝Restrict to bottom 30% and top 30% (*** for 2013)[55]  [56]   head←1↓⎕TCHT MTOV MATRIFY 'x-coord y-coord pc1 pc2 code index bin'[57]   X TMATOUT T←'D:\CAPS\MORE\saltpoints\within-slampoints.txt'[58]   head←1↓⎕TCHT MTOV MATRIFY 'x-coord y-coord index bin'[59]   X[;1 2 6 7] TMATOUT T←'D:\CAPS\MORE\saltpoints\within-blindpoints.txt'[60]  [61]   ⎕←''[62]   ⎕←'Salt marsh (within) points written to ',T[63]   ⎕←''[64]   ⎕←'Number of points per bin:',⎕TCNL[65]   ⎕← '             pc1' OVER ⍕(12↑'     pc2'),((2⍴⊂''),¯1+⍳10)⍪'-'⍪(¯1+⍳10),'|',+⌿X[;5]∘.=10 10⍴¯1+⍳100[66]   ⎕←''[67]   ⎕←'---'[68]   ⎕←''[69]  [70]  [71]  →0  ⍝NOT DOING BORDER MARSHES THIS YEAR[72]  [73]   L0:[74]   ⍝Now do it for border marshes[75]  [76]   X←MATIN 'D:\CAPS\MORE\saltpoints\border.txt'[77]   X←(^/X≠MV)⌿X                       ⍝Remove missing values[78]   X←(.1>UNIFORM 1↑⍴X)⌿X              ⍝Sample it down to 10%[79]   X←X[;2 3 5]                        ⍝X, Y, habloss[80]   X[;3]←X[;3]+.001×UNIFORM 1↑⍴X      ⍝Add a tiny random number to prevent ties in quantiles[81]   X[;3]←1+4×4 QUANTILE X[;3]         ⍝Quartiles of habloss (0-9)[82]  [83]   Y←X[84]   K←0[85]  [86]  L3:X←Y,UNIFORM 1↑⍴Y                 ⍝Random number (6th col)[87]   X←X[⍋X[;3 4];]                     ⍝Sort by class & random number[88]  [89]   U←((X[;3]⍳X[;3])=⍳1↑⍴X)/X[;3][90]   X←X,⊃,/⍳¨+⌿X[;3]∘.=U               ⍝Index[91]   X←(X[;5]≤S[3])⌿X                   ⍝Pick ⍺[2] points in each bin[92]  [93]   D←(((X[;1]∘.-X[;1])*2)+(X[;2]∘.-X[;2])*2)*.5[94]   D←((⍳1↑⍴X)∘.<⍳1↑⍴X)×D<S[1]         ⍝Points within ⍺[1] m of others[95]   X←(~∨⌿D)⌿X                         ⍝Drop subsequent points that are too close[96]  [97]   U←((X[;3]⍳X[;3])=⍳1↑⍴X)/X[;3][98]   X[;5]←⊃,/⍳¨+⌿X[;3]∘.=U             ⍝Re-index[99]   X←(X[;5]≤S[3])⌿X                   ⍝Pick more points[100] [101]  ⎕←'Number of bins with at least 1, 2, ..., n points: ',⍕T←+⌿X[;5]∘.=⍳S[3][102] [103]  →((20>K←K+1)^B←T[1]<100)/L3        ⍝Want at least 1 point in each bin...may not be able to get it[104]                                     ⍝This will be either because IEI and insults are highly correlated and[105]                                     ⍝there simply aren't enough points, or because I'm asking for too great[106]                                     ⍝a spacing.[107] [108]  ⍞←B/'*** Failed to fill all bins in 20 tries.',⎕TCNL[109] [110]  X←X[;1 2 3 5][111]  X←X,(4?4)[X[;3]]                   ⍝Random bin assignments[112]  X←X[⍋X[;3 4];]                     ⍝Sort on bin & index[113] [114]  head←1↓⎕TCHT MTOV MATRIFY 'x-coord y-coord habloss index bin'[115]  X TMATOUT T←'D:\CAPS\MORE\saltpoints\border-slampoints.txt'[116]  head←1↓⎕TCHT MTOV MATRIFY 'x-coord y-coord index bin'[117]  X[;1 2 4 5] TMATOUT T←'D:\CAPS\MORE\saltpoints\border-blindpoints.txt'[118] [119]  ⎕←''[120]  ⎕←'Points written to ',T[121]  ⎕←''[122]  ⎕←'Number of points per bin:',⎕TCNL[123]  ⎕← '    habloss' OVER ⍕'bin' 'n'⍪U,[1.5]+⌿X[;3]∘.=U[124]  ⎕←''    ∇