    ∇ Z←P RKERNELS X;H;M;E;S;D;I;J;K;L;Q;V;Z[1]   ⍝Build resistant kernels for all cells[2]   ⍝   ⍵[1]    resistance grid[3]   ⍝   ⍺[1]    bandwidth (cells); required[4]   ⍝   ⍺[2]    mask grid (run only where mask = 1; reshaped to match resistance; default = 1)[5]   ⍝   ⍺[3]    density (run every nth cell; default = 1)[6]   ⍝   ⍺[4]    1: take sum of kernels (default), 2: take max of kernels[7]   ⍝No edge correction nor expansion for spreading at edges.[8]   ⍝B. Compton, 12 Nov 2014 (Philae lands on Comet 67P/Churyumov-Gerasimenko)[9]   [10]  [11]  [12]   H M E S ← 4↑P,1 1 1                    ⍝Bandwidth, mask, density, what to do with kernels[13]   M←(⍴X)⍴M[14]   D←(⍳1+2×H)-H+1                         ⍝Maximum radius possible to travel[15]   Z←(⍴X)⍴0[16]  [17]   I←0[18]  L1:→(((1↑⍴X))<I←I+1)/0                  ⍝For each row,[19]   →((^/~M[I;])∨(I÷E)≠⌊I÷E)/L1            ⍝   skip this row?[20]   FLUSH[21]   J←0[22]  L2:→(((1↓⍴X))<J←J+1)/L1                 ⍝   For each column,[23]   →((~M[I;J])∨(J÷E)≠⌊J÷E)/L2             ⍝      skip this column?[24]   K←I+D ⋄ L←J+D[25]   K←((K>0)^K≤1↑⍴X)/K                     ⍝      Trim indices at edges[26]   L←((L>0)^L≤1↓⍴X)/L[27]   Q←SPREAD H (K⍳I) (L⍳J) (X[K;L])        ⍝      Build kernel[28]   :if S=1                                ⍝      If summing kernels,[29]      Z[K;L]←Z[K;L]+Q[30]   :else                                  ⍝      Else, take max of kernels[31]      Z[K;L]←Z[K;L]⌈Q[32]   :end[33]   →L2    ∇