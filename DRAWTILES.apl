    ∇ DRAWTILES B;K;M;X;I;J;N;T;H[1]   ⍝Make tile polygon coverage given tile size ⍵[2]   ⍝B. Compton, 6 May 2010[3]   ⍝13 Aug 2013: work properly from Habit@ as well as CAPS; kill previous grid if it exists; name change from BLOCKS[4]   ⍝30 Jan 2014: work properly from CAPS (did this 27 Jan and lost it!)[5]   [6]   [7]   [8]    :if ∨/⎕WSID ⎕SS 'HABITAT'      ⍝If called from Habit@,[9]        SETPARS NREAD path,'habit@.par'[10]       SETBREAK[11]       ∆GRIDINIT ''[12]       ∆SETWINDOW refgrid[13]       H←WINDOW[14]   :else                          ⍝Else, called from CAPS[15]      SETPATHS[16]      INIT[17]      H←GRIDDESCRIBE 1 GRIDNAME 'land'[18]   :end[19]  [20]   H[1 2 4 5]←(⌈H[1 2]÷B),(H[4]-H[5]×B-B|H[2]),H[5]×B[21]   ∆MAKEWINDOW H[22]   X←(1E4×⍉H[1 2]⍴⍳H[2])+H[2 1]⍴⍳H[1][23]   X ∆WRITEGRID pathP PATH 'zztiles'[24]  [25]   ⎕←'Writing to ',pathP,'...' ⋄ FLUSH[26]  [27]   X←'/* arc.aml from DRAWTILES',⍕B[28]   X←X OVER '&s old ',pathP,'tiles',⍕B[29]   X←X OVER '&if [exists %old% -cover] &then'[30]   X←X OVER 'kill %old%'[31]   X←X OVER 'grid'[32]   X←X OVER 'tiles',(⍕B),' = gridpoly(zztiles)'[33]   X←X OVER 'q'[34]   X←X OVER 'kill zztiles'[35]  [36]   X←X OVER 'tables'[37]   X←X OVER 'additem tiles',(⍕B),'.pat tile 5 5 i'[38]   X←X OVER 'additem tiles',(⍕B),'.pat row 5 5 i'[39]   X←X OVER 'additem tiles',(⍕B),'.pat col 5 5 i'[40]   X←X OVER 'sel tiles',(⍕B),'.pat'[41]   X←X OVER 'calc tile = tiles',(⍕B),'-id'[42]   X←X OVER 'calc row = grid-code / 10000'[43]   X←X OVER 'calc col = grid-code - row * 10000'[44]   X←X OVER 'q'[45]  [46]   X←X OVER 'del arc.aml'[47]   X←X OVER 'q'[48]   X←X OVER ''[49]  [50]   X NWRITE pathP PATH 'arc.aml'[51]   ARC pathP[52]   ⎕←'Tiles polygon created in ',pathP,'tiles',⍕B ⋄ FLUSH    ∇