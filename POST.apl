    ∇ POST;blocksize;mixmetrics;samples;qtiles;I;postby;X;T;override_metrics;source;results;a;threshold;badnames;landcover;checkland;grid;names;weights;warn;alt;block;ifchat;pstmetrics;logfile;prettymodel;head;usebench;benchpath;M;postmetrics;refgrid;mask;buffer;landcover;P;L;regionalpost;mixonly;region[1]   ⍝CAPS post-processing, version 3.0[2]   ⍝Parameters are all in parameters.par, under [post][3]   ⍝Takes about an hour on Glyptemys to do Massachusetts[4]   ⍝Note: POST uses inputs_metrics.par, not inputs.par, and doesn't use results.par[5]   ⍝B. Compton, 25 Mar 2011 (from DOPOST)[6]   ⍝28 Mar-6 Apr 2011: substantially rewritten[7]   ⍝8-9 Feb 2012: if called from POSTC, include scale in log file name[8]   ⍝Write prettymodel[9]   ⍝19 Apr 2012: give message telling when it's safe to change parameters; most last INIT to MIXMETRICS[10]  ⍝24 Aug 2012: set mask[11]  ⍝19 Sep 2012: masking[12]  ⍝24-27 Sep 2012: throw error if launched from POSTCALL[13]  ⍝3 May 2013: new option: mixonly does MIXMETRICS but not the rest of POST and skips POSTFRISK[14]  [15]  [16]  [17]   a←⎕AI[2][18]   →(P←1∊(,⎕SI) ⎕SS 'POSTCALL[')/L0           ⍝If called locally,[19]   SETPATHS[20]  L0:INIT[21]   ifchat←0                                   ⍝Don't chatter all the blocks![22]   regionalpost←0 ⋄ region←,⊂''               ⍝This is normal POST[23]   →(1↑L←POSTFRISK 'post')/L9[24]   head←2⊃prettymodel[25]   (3⊃prettymodel) CMATOUT 1⊃prettymodel      ⍝Write model.csv[26]   LOG 'Community model written to ',1⊃prettymodel[27]   M←1[28]  [29]  ⍝Do mixwater on metrics that need it[30]   :if mixmetrics[31]      MIXMETRICS blocksize[32]      →mixonly/0             ⍝If mixonly, we're all done[33]      M←0[34]   :end[35]  [36]  ⍝Post-process metrics[37]   ⍞←M/⎕TCNL,⎕TCNL,'->>> Okay to change parameter files on disk now <<<-',⎕TCNL,⎕TCNL ⋄ FLUSH[38]   buffer←0[39]   1 BENCH samples qtiles blocksize[40]   1 POSTSCALE blocksize[41]  [42]  ⍝Post-process IEI[43]   2 BENCH 0[44]   2 POSTSCALE blocksize[45]  [46]  [47]  ⍝Post-process by ecoregions and watersheds[48]  ⍝Note: before running POSTBY, run fixecoshed.aml-FIXECOSHED-fixecoshed2.aml[49]  ⍝This only need be done once unless ecoregions/watersheds change[50]  [51]   X←MATRIFY postby[52]   I←0[53]  L2:→((1↑⍴X)<I←I+1)/L3           ⍝For each postby grid,[54]   POSTBY X[I;][55]   →L2[56]  [57]  [58]  ⍝Post-process integrated IEI[59]  L3:→(~posti)/L4                 ⍝If doing POSTI,[60]   POSTI ''[61]   3 BENCH 0[62]   3 POSTSCALE blocksize[63]  [64]  [65]  L4:LOG '*** POST is done.  Total time for all phases = ',TIME ⎕AI[2]-a[66]   ⍝∆CLEANUP                        ⍝I don't this this is safe here...[67]   →0[68]  [69]  L9:→(~P)/0                      ⍝If called by POSTCALL and found errors,[70]   ⎕ERROR 'Errors launching POST (See ',logfile,', line ',(⍕L[2]),' for details)'[71]  [72]  [73]  info:('') ('') ('') (0)         ⍝Need for include[74]  check:CHECKVAR 'postland landtypes source results model mixmetrics postby posti checkland friskonly threshold qtiles samples blocksize alt resultpath usebench benchpath mixonly'    ∇