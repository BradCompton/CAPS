    ∇ Z←P TABLERUN M;Z;B;G;R;S;X;head;targets;Q;T;O;H;I;J;K;Y;E;F;W;U[1]   ⍝Sets up calls for CAPS table-based metric ⍵ running across cluster[2]   ⍝⍺ = [1] systems, [2] number of rows per call, [3] grid list for reps (multiple time steps or scenarios)[3]   ⍝Writes one call to TABLECALL for each starting ID, to call for ⍺[2] items in table[4]   ⍝B. Compton, 21 May 2010, from BLOCKRUN[5]   ⍝7 Jul 2010: move INITIALIZE to CAPSRUN so it happens afer grids are killed[6]   ⍝26 Aug 2010: Make sure table has id - add it if not there[7]   ⍝1 Sep 2010: use tables\ path[8]   ⍝23 May 2011: Set up calls for Anthill[9]   ⍝2 Jun 2011: Get the reps function to pass to TABLEREPS; 20 Jun 2011: make it optional[10]  ⍝22 Jun 2011: pass override_pars; 11 Aug put it in run\temp\[11]  ⍝27 Mar 2012: typo fixed[12]  ⍝18 Dec 2012: Allow targets to refer to a range[13]  ⍝5 Mar 2013: pretty severe rewrite to accomidate new reps facility[14]  ⍝14 Mar 2013: pull out REPSRUN subroutine to share with others[15]  ⍝8 Apr 2014: turn off subtask scrambling if scramble = no[16]  [17]  [18]  [19]   S E R B Q ← 0 1 GETINFO M              ⍝Read source names, settings table, result names, buffer size, and include grid name from metric function[20]   O←''[21]   T←⎕EX 'allnames_',M[22]   →(0=⎕NC'override_pars')/L3             ⍝If override_pars exists,[23]   override_pars NWRITE O←pathP,'temp\temp',(FRDBL 15 0⍕?1E5),'.tmp'[24]  [25]  L3:T←GETREPSFN M[26]   →(0∊⍴T)/L0                             ⍝If repsfn: supplied,[27]   T←(0≠⍴T)/' ''',(FRDBL ⍕⍎T),''''        ⍝   evaluate it to modify table[28]  L0:→(~^/(⍕targets)∊'0123456789: ,')/L5  ⍝If targets consists of numbers, spaces, commas, and colon,[29]   Q←'range',((~scramble)/'!'),':',⍕targets  ⍝   it's a range[30]   →L4                                    ⍝Else, targets refers to a file[31]  L5:Q←'function',((~scramble)/'!'),':(',(⍕P[2]),') (''',T,''') (''',O,''') TABLEREPS ''',(pathT PATH targets),''''[32]  [33]  [34]  L4:→(~0∊⍴3⊃P)/L1                        ⍝If no reps,[35]   S←GRIDNAME pathG SUBNAME S             ⍝   Replace grid names where available[36]   E←GRIDNAME pathI SUBNAME E[37]   R←0 resultspar GRIDNAME pathR SUBNAMER R[38]   Z←,⊂(BUILDPAR S),(BUILDPAR E),(BUILDPAR R),(⍕B),' ',(BUILDPAR P[1]),BUILDPAR O    ⍝   build call parameters[39]   U←('!'≡1⊃1↑R)↓R[40]   ⍎(2>≡U)/'U←,⊂U'[41]   →L2[42]  [43]  L1:Z U ← REPSRUN P M S E R B O 0        ⍝Else, fill out reps[44]  [45]  L2:Z←(⊂'TABLECALL '),¨(⊂BUILDPAR M),¨Z[46]   Z←Z,[1.5]⊂Q[47]   Z←Z,⊂'metric: ',M[48]   resultgrids←resultgrids OVER MIX (~0∊⍴R)/(⊂pathR)PATH¨((U⍳U)=⍳⍴U)/U    ∇