    ∇ FINDSTREAMERRORS;tilesize;buffer;loop;test;noread;grids;ffile;tilemapinclude;skiptilemap;E;N;X;S;F;fd;Q;Z;Y;T;head[1]   ⍝Find cells where streams flows into something other than nodata or subtidal[2]   ⍝B. Compton, 7 Dec 2017[3]   [4]   [5]   [6]    INIT [7]    tilesize←2000[8]    buffer←0[9]    loop←test←noread←0 ⋄ grids←0 0⍴''⍝Silly junk for BLOCK, etc.[10]   ffile←'FINDSTREAMERRORS '[11]   BLOCK (2⍴tilesize),buffer[12]   SETTILE[13]  [14]   tilemapinclude←0[15]   skiptilemap←0                    ⍝Don't let DEBUG sabotage this[16]   E←TILEMAP '' tilesize 0 0        ⍝Get tilemap, building it if necessary. This will only help if there's mask grid.[17]   fd←(2*¯1+⍳8),8 2⍴0 1 1 1 1 0 1 ¯1 0 ¯1 ¯1 ¯1 ¯1 0 ¯1 1[18]   Z←0 2⍴0[19]  [20]   ⎕←'Running FINDSTREAMERRORS on ',(⍕+/E),' tiles' ⋄ FLUSH[21]        [22]   N←0[23]  L1:→(~E[N←N+1])/L2                ⍝Repeat: read tile (1st time through tiles), skip if not in tilemap    --- For each tile ---[24]   BREAKCHECK [25]   DOT   [26]   X←READ GRIDNAME 'land'           ⍝   Read land grid,[27]   S←READ GRIDNAME 'streams'        ⍝   streams,[28]   F←READ GRIDNAME 'flow'           ⍝   and flow directions[29]  [30]   Q←(S≠1)^~X∊MV,LOOK 'ocean'       ⍝   Cells that it's not okay to flow into[31]   Y←INDICES (S=1)^F DOWNFLOW Q     ⍝   See what's downstream of each stream cell--mark bad ones[32]   Z←Z⍪↑1 FINDPOINT¨↓Y[33]    [34]  L2: →(0≠NEXTBLOCK)/L1             ⍝Until no more tiles[35]   [36]   head←1↓⎕TCHT MTOV MATRIFY 'x y'[37]   Z TMATOUT T←pathR,'streamerrors.tab'[38]   ⎕←''[39]   LOG 'FINDSTREAMERRORS is done.  Results are in ',T    ∇