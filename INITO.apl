    ∇ P INITO O;F;T[1]   ⍝Initialize CAPS or Habit@ with override parameters ⍵; don't set paths if ⍺[2]   ⍝B. Compton, 13-27 Dec 2013, from INIT_S[3]   ⍝Use GRIDNAME for mosaicref[4]   ⍝13 Jan 2014: do 2nd round of application initialization after CONFIG so we can do locking if need be[5]   ⍝27 Jan 2014: SETPATHS is only from CAPS[6]   ⍝31 Jan 2014: need 2nd round for Habit@ too[7]   ⍝11 Apr 2014: changes to get fewer (or no!) locks on reference grid on CAPS subtask initialization; 14 Apr 2014: revisions[8]   ⍝28 Apr 2014: clear local gridinfo cache, and read it if name was set by override_pars[9]   ⍝27 Jun 2014: make gridinfo work properly when mosaics = no[10]  ⍝13 Jul 2015: don't reset paths.par when run locally[11]  [12]  [13]  [14]   ⍎(0=⎕NC'P')/'P←0'[15]   :if ~(⊂STRIP ⎕WSID)∊'CAPS' 'HABITAT'   ⍝If not called within base workspace (implying this is an Anthill call),[16]      pathdir←'paths.par'         ⍝   Reset paths.par in case a previous task changed it[17]   :end[18]   ⎕SA←''[19]   ⎕ALX←'STOP'[20]  [21]   CLEANUP                        ⍝Initialize grid server(s)[22]   referencewindow←⍳0             ⍝Force setting reference window (in a CAPS run, it'll come from override_pars)[23]   gridinfo←0 3⍴''                ⍝Clear local cache of gridinfo[24]   :if ~0∊⍴O                      ⍝If override_pars is non-empty,[25]      gridinfofile←''[26]      override_pars←NREAD O       ⍝   read and set it[27]      SETPARS override_pars       ⍝   set override_pars in case it sets pathdir[28]      :if 0≠⍴gridinfofile         ⍝   If gridinfo is supplied, read it[29]         gridinfo←1 ⎕TCHT 1 MATIN gridinfofile[30]         gridinfo[;2]←⍎¨LOWTOHIX¨gridinfo[;2][31]         gridinfo←((1↑⍴gridinfo),3)↑gridinfo,⊂''  ⍝      create empty mosaics column if it's not there[32]         T←⊃,/0≠⍴¨gridinfo[;3][33]         :if ∨/T[34]            gridinfo[T/⍳1↑⍴gridinfo;3]←⍎¨LOWTOHIX¨⍕¨T/gridinfo[;3][35]         :end[36]         gridinfo[(~T)/⍳1↑⍴gridinfo;3]←⊂⍳0[37]      :end[38]   :end[39]  [40]   :if framework≡'caps'           ⍝Now do application-specific initialization[41]      :if ~P[42]         SETPATHS                 ⍝   set paths, unless we're not to[43]      :end[44]      INIT_CAPS[45]   :elseif framework≡'habit@'[46]      INIT_HABITAT[47]   :end[48]  [49]   :if cluster                    ⍝If running on the cluster,[50]      CONFIG                      ⍝   do Anthill configuration and initialize the lock server[51]   :end[52]  [53]   :if framework≡'caps'           ⍝Do 2nd round application-specific initialization[54]      INIT_CAPS2[55]   :elseif framework≡'habit@'[56]      INIT_HABITAT2[57]   :end[58]  [59]   ⎕ERROR ((~landscapewide)^~mosaics)/'Paramter error: Must have at least one of landscapewide = yes or mosaics = yes'[60]  [61]  ⍝ ⍞←cluster/'---> Connecting to grid server(s)...' ⋄ FLUSH[62]  [63]   :if landscapewide                                  ⍝If landscapewide, set up full landscape grid server[64]      :if cluster^0∊⍴gridserver                       ⍝   if cluster run and no gridserver supplied,[65]         1 GRIDINIT ''[66]         :if 0∊⍴referencewindow                       ⍝   If we weren't passed referencewindow,[67]            referencewindow←5↑GRIDDESCRIBE refgrid    ⍝   Get the window for the reference grid--we need it here[68]         :end[69]         gridserver←FINDSERVER referencewindow refgrid⍝      find a grid server that matches this window[70]         ⎕ERROR (0∊⍴gridserver)/⎕TCNL,'No grid server in ',pathA,'gridservers.txt for reference grid ',refgrid,', window = (',(1↓⊃,/',',¨⍕¨5↑referencewindow),')'[71]      :end[72]      :if ~cluster                                    ⍝   if local,[73]         gridserver←''                                ⍝      use local grid server no matter what[74]      :end[75]      1 GRIDINIT gridserver                           ⍝      initialize grids server[76]      1 SETWINDOW refgrid                             ⍝      and set window[77]   :end[78]  [79]   :if mosaics                                        ⍝If we're using mosaics,[80]      ⎕ERROR (0∊⍴mosaicref)/'Error: mosaics = yes but no mosaicref was supplied.'[81]      MOSAICINIT (GRIDNAME mosaicref) 'gridservers.txt' ⍝   initialize[82]   :end[83]  [84]   ⍝⍞←cluster/'done.',⎕TCNL ⋄ FLUSH    ∇