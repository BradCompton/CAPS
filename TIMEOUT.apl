    ∇ Z←A TIMEOUT N;Q;X;R;T;H;head[1]   ⍝Initiate timeout for directory ⍺ for computer 1⊃⍵, thread 2⊃⍵, and timeout 3⊃⍵[2]   ⍝Return 1 if successful recovery; 0 if didn't need to recover[3]   ⍝B. Compton, 14 Apr 2011[4]   ⍝12 Mar 2013: modify for lock server[5]   [6]   [7]   WE DONT WANT TO DO THIS ANY MORE! IT CORRUPTS ANTHILL RUNS! (13 Aug 2013)[8]   [9]   [10]   :if uselockserver[11]      :if (LOCKSTATUS A)[2]<N[2][12]         ⎕←'Lock isn''t older than timeout. Lock recovery canceled.'[13]         →Z←0[14]      :endif[15]   :endif[16]   ⎕←'Timeout triggered.  Recovering...' ⋄ FLUSH[17]   →(IFEXISTS R←A,'recovery\')/L1         ⍝If recovery\ directory doesn't exist,[18]   MAKEDIR R                              ⍝   Create it[19]  L1:T←R GETLOCK N[2 3]                   ⍝Lock recovery directory[20]  [21]   →(IFEXISTS Q←R,'recovery.log')/L2      ⍝If recovery.log doesn't exist,[22]   X←'Date',⎕TCHT,'Computer',⎕TCHT,'Thread',⎕TCHT,'Message'[23]   X NWRITE Q                             ⍝   Create it with header[24]   →L3                                    ⍝   and complete recovery[25]  [26]  L2:X←1 ⎕TCHT MATIN Q                    ⍝Read log[27]   H←⎕TCHT MATRIFY head[28]   T←⊃X[1↑⍴X;H COL 'date']                ⍝Time of most recent recovery[29]   →(N[3]<⎕TS ELAPSED PARSEDATE T)/L3     ⍝If a recovery happened within timeout,[30]   RETURNLOCK R                           ⍝   Forget it...somebody else did the work[31]   ⎕←'Recovery was already successful within timeout' ⋄ FLUSH[32]   →Z←0[33]  [34]  L3:X←NOW,⎕TCHT,(⊃N[1]),⎕TCHT,(⍕N[2]),⎕TCHT,'Recovered from timeout'[35]   X NAPPEND Q                            ⍝Write to log[36]   RETURNLOCK A                           ⍝Unlock primary directory[37]   RETURNLOCK R                           ⍝Unlock recovery subdirectory[38]   ⎕←'Recovered' ⋄ FLUSH[39]   Z←1    ∇