    ∇ Z←F MIXTROUBLE N;Q;I;K;J[1]   ⍝Subroutine of MAKEMIXWATER/LAKES; look for inflowing cells ⍵ that flow into other inflowing cells given flow grid ⍺[2]   ⍝B. Compton, 20 Jan 2012[3]   ⍝23 Mar 2012: remove duplicates and don't follow longer than necessary[4]   ⍝16 May 2014: Total rewrite. Must keep last entry into wetland, not 1st! Otherwise minor flows leaving wetland and joining major flows[5]   ⍝   above wetland end up wiping out major flow.[6]   [7]   [8]   [9]    K←0,INDICES N≠0[10]   I←0[11]  L1:→((1↑⍴K)<I←I+1)/L3               ⍝For each inflowing cell,[12]   J←K[I;2 3][13]  L2:J←,F NEXTFLOW J                  ⍝   Flow down[14]   →(0=⊃J)/L1                         ⍝   While still in window,[15]   :if (⊂J)∊↓K[;2 3]                  ⍝   If we've hit another inflow,[16]      K[I;1]←1                        ⍝      exclude our inflow - we always want the last of multiple inflows[17]      →L1                             ⍝      and we're done with this inflow[18]   :end[19]   →L2[20]  [21]  L3:Z←N SCATR (K[;1]⌿K[;2 3]) 0[22]  [23]  [24]  [25]  [26]  [27]  [28]  ⍝ Z←N≠0[29]  ⍝ →(0∊⍴Q←INDICES Z)/0[30]  ⍝L1:Q←(^/Q≠0)⌿Q←⊃⍪/(⊂F) NEXTFLOW¨↓Q  ⍝Repeat: follow down from our cells[31]  ⍝ Q←Q[⍋Q;][32]  ⍝ Q←(∨/Q≠¯1 0↓0⍪Q)⌿Q                 ⍝   remove duplicates[33]  ⍝ Q←(2>Z SCATI Q)⌿Q                  ⍝   if we hit any Zs > 2, no need to keep following[34]  ⍝ →(0∊⍴Q)/L2                         ⍝   until we've run out of sublandscape[35]  ⍝ Z←Z+((⍴Z)⍴0) SCATR Q 1[36]  ⍝ →L1[37]  ⍝[38]  ⍝L2:Z←N×Z=1                          ⍝Keep only uppermost cells in strings    ∇