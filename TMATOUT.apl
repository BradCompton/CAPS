    ∇ X TMATOUT F;J;S;D;I;L;N;T[1]   ⍝Write tab-delimited numeric matrix ⍺ to file ⍵, delimiter 2⊃⍵[2]   ⍝Treat null and strings with spaces properly (28 Apr 2005)[3]   ⍝Uses global head as header line[4]   ⍝2⊃⍵ is delimiter, if present[5]   ⍝B. Compton, from CMATOUT (1 Jun 2006)[6]   ⍝23 Mar 2009: failed for ⊂''[7]   ⍝31 Mar 2009: no header if head is blank[8]   ⍝4 Aug 2010: merge with CMATOUT; write big matrices in loops.  Note: does not lock file, so not cluster-friendly[9]   ⍝19 Apr 2011: be more careful with empty matrix[10]  ⍝19 May 2011: don't trash quotes![11]  ⍝18 Oct 2011: when creating huge files, wait for windows file system[12]  ⍝10 Dec 2012: if empty filename, exit (for use with INITIALIZE)[13]  ⍝13 Jul 2016: don't crash if one of the columns is a character scalar![14]  [15]  [16]  [17]   →(0∊⍴F)/0                      ⍝If empty filename, just exit[18]   D←⎕TCHT[19]   ⍎(2≤≡F)/'F D ← F'              ⍝If 2⊃⍵ passed, it's the delimiter[20]   →(~0∊⍴X)/L1                    ⍝If empty matrix,[21]   head NWRITE F                  ⍝   just write header[22]   →0[23]  L1:→((L←1E4)<1↑⍴X)/L5           ⍝If reasonably small matrix (no more than L rows),[24]   J←0[25]  L2:→((1↓⍴X)<J←J+1)/L3[26]   →(' '≠''⍴1↑0⍴⊃X[1;J])/L2[27]   X[;J]←↓VTOM '. .⍬' TEXTREPL MTOV MIX,¨⍕¨X[;J][28]   X[;J]←'⍞',¨(FRDBL¨X[;J]),¨'⍞'[29]   →L2[30]  L3:X←0 1↓MIX,/D,¨⍕¨X[31]  L4:X←head,(0∊⍴head)↓MTOV X[32]   X←'.⍬. .⍞.' TEXTREPL X[33]   (DEB HITOLOW,X) NWRITE F[34]   →0[35]  [36]  L5:I←0                          ⍝Else, absurdly huge matrix - we'll have to loop[37]   head NWRITE F[38]  [39]  L6:X[I+⍳((1↑⍴X)-I)⌊L;] TMATAPPEND F D[40]   ⍎(I=0)/'T←⎕DL 5'               ⍝   wait a while so windows file system realizes it exists.  Bah.[41]   I←I+L[42]   →(I<1↑⍴X)/L6    ∇