    ∇ Z←G BILINEAR P;Q;I;D;C;V;O;Y;X;B[1]   ⍝Bilinear interpolation of grid ⍺ at points ⍵[2]   ⍝B. Compton, 27 Feb 2008[3]   ⍝10 Aug 2010: linearize last line for 60% speed-up[4]   [5]   [6]   [7]    P←(¯2↑1,⍴P)⍴P[8]    Q←(P-(⍴P)⍴WINDOW[3 4])÷CELLSIZE                 ⍝In terms of cells[9]    C←⌽|((⍴P)⍴0,WINDOW[2]+1)-⌈Q-(⍴P)⍴.5 .5          ⍝Lower left cell (rows,cols)[10]  [11]   C←C+1                ⍝Buffer for points near edges[12]   G←G[;1],G,G[;1↓⍴G][13]   G←G[1;]⍪G⍪G[1↑⍴G;][14]  [15]   V←(G SCATI C+(⍴C)⍴¯1 0),(G SCATI C+(⍴C)⍴¯1 1),(G SCATI C),[1.5]G SCATI C+(⍴C)⍴0 1  ⍝4 cell values for each point[16]   O←|B←¯.5+⌽Q-⌊Q       ⍝Offset from cell center for each point[17]   X←O[;1],1-O[;,1][18]   Y←O[;2],1-O[;,2][19]   B←0>B×(⍴B)⍴1 ¯1      ⍝Adjust for quadrant within cell[20]   X←B[;1]⌽X[21]   Y←B[;2]⌽Y[22]  [23]   V[B;3 4]←V[B←(X[;1]=0)/⍳1↑⍴V;1 2]   ⍝On x-lines[24]   V[B;2 3]←V[B←(X[;2]=0)/⍳1↑⍴V;3 4]   ⍝On y-lines[25]   V[B;1 3 4]←V[B←(^/X=0)/⍳1↑⍴V;1 3 4] ⍝On cell centers[26]  [27]   Z←+/(2/X)×V×(2/Y)[;1 3 2 4]    ∇