    ∇ A KERNEL_UNION_FINISH S;buffer;loop;test;noread;grids;ffile;tilesize;tilemapinclude;skiptilemap;E;N;I;X;Y;Z;result;slice[1]   ⍝Slice union of kernels given threshold (found by KERNEL_UNION)[2]   ⍝Make sure that the threshold you pick is greater than the background value for any of the source kernels![3]   ⍝Parameters:[4]   ⍝   grids               list of source grids...all must be quantile-scaled[5]   ⍝   slice               cutpoint[6]   ⍝   result              result grid[7]   ⍝   tilesize            size of tiles (in cells)[8]   ⍝   targets = '1:1'     needs to be in parameters.par to run a single thread[9]   ⍝Primary result is binary, but also returns <result>n with count of cores[10]  ⍝Runs as a CAPS metric, but only uses one thread.  It'll be fastest if you set host = 'w00'.[11]  ⍝B. Compton, 17 Jul 2017 (from KERNEL_UNION)[12]  [13]  [14]  [15]   READPARS ME[16]   buffer←4⊃A[17]  [18]  [19]   loop←test←noread←0 ⋄ grids←0 0⍴''  ⍝Silly junk for BLOCK, etc.[20]   ffile←'KERNEL_UNION_FINISH'[21]   BLOCK (2⍴tilesize),buffer[22]   SETTILE[23]   tilemapinclude←0[24]   skiptilemap←0                      ⍝Don't let DEBUG sabotage this[25]   E←TILEMAP '' tilesize 0 0          ⍝Get tilemap, building it if necessary. This will only help if there's mask grid.[26]   Y←(0,¯1+⍴1⊃A)⍴0[27]  [28]   N←0[29]  L1:→(~E[N←N+1])/L4                  ⍝Repeat: read tile (1st time through tiles), skip if not in tilemap    --- For each tile ---[30]   BREAKCHECK [31]   DOT   [32]   X←READ 1⊃1⊃A                       ⍝   Read landcover[33]   Z←(⍴X)⍴0[34]  [35]   I←1[36]  L2:→((⍴1⊃A)<I←I+1)/L3               ⍝   For each source grid,[37]   X←READ I⊃1⊃A[38]   Z←Z+X≥slice[39]   →L2[40]  [41]  L3:Z←MVREP Z (Z=0)[42]   (MVREP (Z≥1) (Z=MV)) WRITEI 1⊃3⊃A[43]   Z WRITEI 2⊃3⊃A[44]  [45]  L4:→(0≠NEXTBLOCK)/L1                ⍝Until no more tiles[46]  [47]   ⎕←''[48]   LOG 'Result grid written to ',result   [49]   →0[50]  [51]  [52]  [53]  what:auxiliary[54]  type:table[55]  info:((⊂'land'),FRDBL¨↓MATRIFY grids) ('') (result (result,'n')) 0 ''      ⍝Source grid, settings table, result grid, buffer size, and include grid[56]  check:CHECKVAR 'grids slice tilesize targets'    ∇