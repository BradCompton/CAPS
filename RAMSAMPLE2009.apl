    ∇ S RAMSAMPLE2009 W;E;X;Y;U;D;T;M;qt;qtiles;head;K;B;I;H[1]   ⍝Process Theresa's sampling plots for 2009 season[2]   ⍝RAMSAMPLE 1 → create random points; ⍺ = number of random points[3]   ⍝&r ramsample[4]   ⍝RAMSAMPLE 2 → process results; ⍺ = separation distance, points per bin[5]   ⍝B. Compton, 29 Feb-3 Mar 2008[6]   ⍝28 Apr 2008: allow more points, print table, give blind points with randomly assigned bins[7]   ⍝17 Apr 2009: for 2009 season[8]   [9]   [10]  →(1 2=W)/L1,L2[11]  [12]  L1:⍝Create random points for ramsample.aml[13]   ⍎(0=⎕NC'S')/'S←1E6'[14]   I←0[15]  L11:→(2<I←I+1)/0                    ⍝For each watershed[16]   E←(2 4⍴116641 167812 916908 941667 181716 220499 883010 931946)[I;][17]   X←E[1]+(UNIFORM S)×(E[2]-E[1])[18]   Y←E[3]+(UNIFORM S)×(E[4]-E[3])[19]   (X,[1.5]Y) MATOUT 'D:\CAPSma\RAM\',(I⊃'millers' 'concord'),'\PTS.TXT'[20]   →L11[21]  [22]  L2:⍎(0=⎕NC'S')/'S←500 5'            ⍝Separation distance, points per bin[23]   I←0[24]  L21:→(2<I←I+1)/0                    ⍝For each watershed,[25]   H←(I⊃'millers' 'concord')[26]   ⎕←H,' watershed:'[27]   ⎕←''[28]   X←MATIN 'D:\CAPSWEST\RAM\',H,'\sample.txt'[29]   X←0 1↓X                            ⍝X is X, Y, IEI, type, insults, verboten (river buffer)[30]   X←(~(FRDBL¨X[;5])≡¨⊂'MISSING')⌿X[31]   X←(~(FRDBL¨X[;4])≡¨⊂'MISSING')⌿X[32]  [33]   X[;3]←⎕FI ,' ',MIX X[;3][34]   X[;4]←⎕FI ,' ',MIX X[;4][35]   X[;5]←⎕FI ,' ',MIX X[;5][36]   X[;6]←⎕FI ,' ',MIX X[;6][37]   X←(~X[;6])⌿X[;⍳5]                   ⍝Drop out points too close to big rivers[38]  [39]  [40]   X[;4]←X[;4]∊14 16  ⍝1 = FOWET-D or -M[41]   X←(X[;4]∊1)⌿X[42]  [43]   X[;3 5]←X[;3 5]+.001×UNIFORM (1↑⍴X),2   ⍝Add a tiny random number to prevent ties in quantiles[44]   X[;3]←10×10 QUANTILE X[;3]         ⍝Deciles of IEI (0-9)[45]   X[;5]←10×10 QUANTILE X[;5]         ⍝Deciles of insults (0-9)[46]   X←X,(10×X[;3])+X[;5]               ⍝Digits: IEI, insults[47]  [48]   Y←X[49]   K←0[50]  [51]  L3:X←Y,UNIFORM 1↑⍴Y[52]   X←X[⍋X[;6 7];]                     ⍝Sort by class & random number[53]  [54]   U←((X[;6]⍳X[;6])=⍳1↑⍴X)/X[;6][55]   X←X,⊃,/⍳¨+⌿X[;6]∘.=U               ⍝Index[56]   X←(X[;8]≤S[2])⌿X                   ⍝Pick ⍺[2] points in each bin[57]  [58]   D←(((X[;1]∘.-X[;1])*2)+(X[;2]∘.-X[;2])*2)*.5[59]   D←((⍳1↑⍴X)∘.<⍳1↑⍴X)×D<S[1]         ⍝Points within ⍺[1] m of others[60]   X←(~∨⌿D)⌿X                         ⍝Drop subsequent points that are too close[61]  [62]   U←((X[;6]⍳X[;6])=⍳1↑⍴X)/X[;6][63]   X[;8]←⊃,/⍳¨+⌿X[;6]∘.=U             ⍝Re-index[64]   X←(X[;8]≤S[2])⌿X                   ⍝Pick more points[65]  [66]   ⎕←'Number of bins with at least 1, 2, ..., n points: ',⍕T←+⌿X[;8]∘.=⍳S[2][67]  [68]   →((20>K←K+1)^B←T[1]<100)/L3        ⍝Want at least 1 point in each bin...may not be able to get it[69]                                      ⍝This will be either because IEI and insults are highly correlated and[70]                                      ⍝there simply aren't enough points, or because I'm asking for too great[71]                                      ⍝a spacing.[72]  [73]   ⍞←B/'*** Failed to fill all bins in 20 tries.',⎕TCNL[74]  [75]   X←X[;1 2 3 5 6 8][76]   X←X,(100?100)[1+X[;5]]             ⍝Random bin assignments[77]   X←X[⍋X[;7 6];]                     ⍝Sort on bin & index[78]  [79]   head←1↓⎕TCHT MTOV MATRIFY 'x-coord y-coord IEI insults code index bin'[80]   X TMATOUT T←'d:\CAPSma\ram\',H,'-slampoints.txt'[81]   head←1↓⎕TCHT MTOV MATRIFY 'x-coord y-coord index bin'[82]   X[;1 2 6 7] TMATOUT T←'d:\CAPSma\ram\',H,'-blindpoints.txt'[83]  [84]   ⎕←''[85]   ⎕←'Points written to ',T[86]   ⎕←''[87]   ⎕←'Number of points per bin:',⎕TCNL[88]   ⎕← '             insults' OVER ⍕(12↑'     IEI'),((2⍴⊂''),¯1+⍳10)⍪'-'⍪(¯1+⍳10),'|',+⌿X[;5]∘.=10 10⍴¯1+⍳100[89]   ⎕←''[90]   →L21    ∇